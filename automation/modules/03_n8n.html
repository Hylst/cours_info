<!-- MODULE 3: n8n (DEEP DIVE & MASTERY) -->
<section id="m3">
    <div class="container">
        <div class="sec-header">
            <div class="sec-num">03</div>
            <div>
                <h2 class="sec-title">Architecture n8n</h2>
                <p class="sec-sub">Ma√Ætriser l'OS de l'Automatisation</p>
            </div>
        </div>

        <div class="img-container">
            <img src="assets/n8n_architecture_2025_1766252310261.jpg" alt="Architecture n8n Isom√©trique">
        </div>

        <!-- 3.1 CORE CONCEPTS (Revised) -->
        <div class="concept-box" style="border-left-color: #ff6b6b;">
            <strong>Le Pi√®ge Classique :</strong><br>
            n8n n'est pas "juste" un Zapier moins cher. C'est un environnement de <em
                style="color:#ff6b6b;">d√©veloppement visuel</em>.
            Si vous ne comprenez pas le passage des donn√©es (Items), vous serez bloqu√© au premier <code>IF</code>.
        </div>

        <div class="grid2">
            <div>
                <h3>1. La Structure "Item"</h3>
                <p>Tout tourne autour du JSON. Un nceud re√ßoit un <strong>Tableau</strong> et renvoie un
                    <strong>Tableau</strong>.
                </p>
                <div class="code-block" style="font-size:0.8rem;">
                    [
                    {
                    "json": { "email": "alice@corp.com", "id": 1 },
                    "pair": 0
                    },
                    {
                    "json": { "email": "bob@corp.com", "id": 2 },
                    "pair": 1
                    }
                    ]
                </div>
            </div>
            <div>
                <h3>2. L'Expression Language</h3>
                <p>Pour rendre les n≈ìuds dynamiques, on utilise des expressions JavaScript (doubles accolades).</p>
                <ul class="vocab-list">
                    <dt>{{ $json.email }}</dt>
                    <dd>Acc√®de √† la propri√©t√© "email" de l'item courant.</dd>
                    <dt>{{ $now.plus(1, 'days') }}</dt>
                    <dd>G√®re les dates (librairie Luxon int√©gr√©e).</dd>
                    <dt>{{ $node["Trigger"].json.id }}</dt>
                    <dd>Va chercher une donn√©e sp√©cifique dans un n≈ìud pr√©c√©dent (Back-reference).</dd>
                </ul>
            </div>
        </div>

        <!-- 3.2 DEBUGGING GUIDE (NEW) -->
        <h3 class="sec-title-small" style="margin-top:40px; color:#fff;">üõ† Debugging & Optimisation</h3>
        <div class="grid2" style="margin-bottom:30px;">
            <div class="scenario-card" style="border-left: 3px solid #e17055;">
                <h4>üîç Lire les Logs</h4>
                <p style="font-size:0.85rem; margin-top:5px;">Dans l'historique d'ex√©cution :</p>
                <ul class="clean-list" style="font-size:0.8rem;">
                    <li><strong>Input :</strong> Ce qui est rentr√© dans le n≈ìud.</li>
                    <li><strong>Output :</strong> Ce qui en est sorti.</li>
                    <li><em>Si Output est vide, le n≈ìud a filtr√© toutes les donn√©es.</em></li>
                </ul>
            </div>
            <div class="scenario-card" style="border-left: 3px solid #00cec9;">
                <h4>üìå Pin Data</h4>
                <p style="font-size:0.85rem; margin-top:5px;">Ne rejouez pas tout le workflow √† chaque test API !
                </p>
                <p style="font-size:0.8rem; color:#b2bec3;">Cliquez sur l'√©pingle d'un n≈ìud pour figer ses donn√©es
                    de sortie. Le n≈ìud suivant utilisera ces donn√©es "mock√©es" sans rappeler l'API pr√©c√©dente.</p>
            </div>
        </div>

        <!-- 3.3 CORE NODES DEEP DIVE (NEW) -->
        <h3 class="sec-title-small" style="color:#fff;">üß© Les N≈ìuds Indispensables</h3>
        <div class="feature-grid"
            style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); margin-bottom:30px;">
            <div class="scenario-card">
                <strong>Merge Node</strong>
                <p style="font-size:0.8rem; color:#b2bec3; margin-top:5px;">
                    ‚Ä¢ <strong>Append :</strong> Met les tableaux bout √† bout.<br>
                    ‚Ä¢ <strong>Wait (Mode "Pass-through") :</strong> Attend que la branche A soit finie avant de
                    lancer la B. Vital pour s√©quencer les actions.
                </p>
            </div>
            <div class="scenario-card">
                <strong>Switch / If</strong>
                <p style="font-size:0.8rem; color:#b2bec3; margin-top:5px;">
                    Dirige le trafic. Le "Switch" est plus propre que des "If" en cascade.<br>
                    <em>Ex: Routez par "Type de Client" (VIP, Standard, Prospect).</em>
                </p>
            </div>
            <div class="scenario-card">
                <strong>Split In Batches</strong>
                <p style="font-size:0.8rem; color:#b2bec3; margin-top:5px;">
                    Pour ne pas faire exploser la RAM ou les limites API.<br>
                    <em>"Traite ces 1000 emails par paquets de 10."</em>
                </p>
            </div>
            <div class="scenario-card">
                <strong>Code Node</strong>
                <p style="font-size:0.8rem; color:#b2bec3; margin-top:5px;">
                    L'√©chappatoire. Quand le No-Code est trop lourd, 5 lignes de JS r√©solvent le probl√®me.
                    Manipulation complexe d'Arrays ou Regex.
                </p>
            </div>
        </div>

        <!-- 3.4 USE CASE: LEAD ENRICHMENT (NEW) -->
        <div class="concept-box"
            style="margin-top:30px; background: rgba(0, 206, 201, 0.05); border-left-color: #00cec9;">
            <h3 style="color:#00cec9; margin-bottom:15px;">Cas Pratique : Lead Enrichment Machine</h3>
            <div class="tutorial-step" style="margin-bottom:0;">
                <code style="display:block; padding:10px; border-radius:6px; font-size:0.8rem; line-height:1.6;">
                        <span style="color:#ff7675;">1. Webhook</span> : Re√ßoit l'email depuis Typeform.<br>
                        ‚¨áÔ∏è<br>
                        <span style="color:#fab1a0;">2. API Clearbit/Apollo</span> : "Qui est ce prospect ?" (Job, Taille bo√Æte).<br>
                        ‚¨áÔ∏è<br>
                        <span style="color:#ffeaa7;">3. IF</span> : Est-ce un CEO de +50 employ√©s ?<br>
                        ‚îú‚îÄ‚îÄ <strong style="color:#55efc4;">OUI</strong> :<br>
                        ‚îÇ   ‚îú‚îÄ‚îÄ <span style="color:#a29bfe;">AI Agent</span> : R√©dige une intro personnalis√©e LinkedIn.<br>
                        ‚îÇ   ‚îú‚îÄ‚îÄ <span style="color:#0984e3;">HubSpot</span> : Cr√©e le deal "Hot Lead".<br>
                        ‚îÇ   ‚îî‚îÄ‚îÄ <span style="color:#fff;">Slack</span> : Notifie l'√©quipe Sales üî•.<br>
                        ‚îî‚îÄ‚îÄ <strong style="color:#636e72;">NON</strong> :<br>
                            ‚îî‚îÄ‚îÄ <span style="color:#dfe6e9;">Mailchimp</span> : Ajoute √† la newsletter classique.
                    </code>
            </div>
        </div>

        <div class="tip" style="margin-top:20px;">
            <strong>Astuce Pro :</strong> Nommez TOUJOURS vos n≈ìuds (ex: "Get_User_Data" au lieu de "HTTP Request
            1").
            Votre "Future You" (dans 3 mois) vous remerciera quand il faudra d√©boguer <code>$node["HTTP Request
                    43"]</code>.
        </div>
    </div>
</section>