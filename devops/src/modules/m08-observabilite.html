<!-- MODULE 08: OBSERVABILITY -->
<section id="m8" style="background: radial-gradient(circle at center, rgba(253, 203, 110, 0.06) 0%, transparent 60%);">
    <div class="container">
        <div class="sec-header">
            <div class="sec-num" style="color:#fdcb6e; border-color:#fdcb6e;">08</div>
            <div>
                <h2 class="sec-title" style="color:#fdcb6e;">üëÅÔ∏è Observabilit√©</h2>
                <p class="sec-sub">Logs, Metrics, Traces - Les 3 Piliers</p>
            </div>
        </div>

        <div class="analogy-box" style="border-left-color:#fdcb6e;">
            <h4>üèéÔ∏è Analogie : Le Tableau de Bord F1</h4>
            <p>Le <strong>Monitoring</strong> vous dit "Le moteur fume" (C'est cass√©).<br>
                L'<strong>Observabilit√©</strong> vous permet de demander "Pourquoi ?" en regardant la t√©l√©m√©trie
                compl√®te.</p>
        </div>

        <!-- Introduction Contextuelle -->
        <div class="module-intro">
            <h3>üìñ Observabilit√© : Illuminer la Bo√Æte Noire</h3>
            <p>Dans un syst√®me monolithique simple, un log suffit. Dans un cluster Kubernetes avec 200
                microservices, c'est impossible. L'observabilit√© est la capacit√© de comprendre l'√©tat interne d'un
                syst√®me <strong>uniquement</strong> en regardant ses sorties (Metrics, Logs, Traces).</p>
            <p>On passe du monitoring <strong>R√©actif</strong> ("Tiens, √ßa a crash√©") √† l'observabilit√©
                <strong>Proactive</strong> ("La latence monte sur le service X, √ßa va bient√¥t saturer").
            </p>
        </div>

        <!-- Knowledge Box -->
        <div class="knowledge-box">
            <h4>üí° Le saviez-vous ? Les 4 Golden Signals</h4>
            <p>Google a d√©fini dans son livre SRE les <strong>4 signaux d'or</strong> du monitoring que tout
                dashboard devrait avoir :</p>
            <ol style="margin: 10px 0; padding-left: 25px; color: var(--text);">
                <li><strong>Latency</strong> : Temps de r√©ponse (ms).</li>
                <li><strong>Traffic</strong> : Nombre de requ√™tes/sec.</li>
                <li><strong>Errors</strong> : Taux de succ√®s vs √©chec.</li>
                <li><strong>Saturation</strong> : Utilisation des ressources (CPU, RAM, Disque).</li>
            </ol>
        </div>


        <!-- 3 PILLARS -->
        <h3 style="color:#fff; margin-top:30px; margin-bottom:15px;">üèõÔ∏è A. Les 3 Piliers</h3>
        <div class="grid3">
            <div class="tool-card" style="border-top:3px solid #00cec9;">
                <span class="tool-icon">üìú</span>
                <h4>Logs</h4>
                <p><strong>Quoi ?</strong> √âv√©nements textuels horodat√©s<br>
                    <strong>Usage :</strong> Debugging, audit trail<br>
                    <em>Outils: ELK, Loki, CloudWatch</em>
                </p>
            </div>
            <div class="tool-card" style="border-top:3px solid #74b9ff;">
                <span class="tool-icon">üìà</span>
                <h4>Metrics</h4>
                <p><strong>Quoi ?</strong> Chiffres agr√©g√©s dans le temps<br>
                    <strong>Usage :</strong> Alerting, dashboards<br>
                    <em>Outils: Prometheus, Datadog</em>
                </p>
            </div>
            <div class="tool-card" style="border-top:3px solid #a29bfe;">
                <span class="tool-icon">üïµÔ∏è</span>
                <h4>Traces</h4>
                <p><strong>Quoi ?</strong> Suivi d'une requ√™te multi-services<br>
                    <strong>Usage :</strong> Latency, bottlenecks<br>
                    <em>Outils: Jaeger, OpenTelemetry</em>
                </p>
            </div>
        </div>

        <!-- STACKS TABLE -->
        <h3 style="color:#fff; margin-top:30px; margin-bottom:15px;">üõ†Ô∏è B. Stacks Populaires</h3>


        <!-- Comparison: Logs vs Metrics vs Traces -->
        <h3 style="color:#fff; margin-top:40px; margin-bottom:15px;">üìä Les 3 Piliers : Quand utiliser quoi ?</h3>
        <div class="comparison-container">
            <div class="comparison-table">
                <div class="comparison-col">
                    <h4>üìú Logs (√âv√©nements)</h4>
                    <ul>
                        <li><strong>Granularit√©</strong> : Haute (d√©tails pr√©cis).</li>
                        <li><strong>Co√ªt</strong> : √âlev√© (stockage massif).</li>
                        <li><strong>Usage</strong> : "Pourquoi cette requ√™te sp√©cifique a √©chou√© ?"</li>
                    </ul>
                </div>
                <div class="comparison-col winner">
                    <h4>üïµÔ∏è Traces (Parcours)</h4>
                    <ul>
                        <li><strong>Granularit√©</strong> : Contextuelle (multi-services).</li>
                        <li><strong>Co√ªt</strong> : Moyen (√©chantillonnage n√©cessaire).</li>
                        <li><strong>Usage</strong> : "O√π est pass√©e la seconde de latence entre A et B ?"</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Case Study: Uber -->
        <div class="case-study">
            <h4>üìä Cas d'√©tude : Uber - G√©rer 500 millions de m√©triques</h4>
            <div class="case-metrics">
                <div class="metric">
                    <span class="metric-value">500M</span>
                    <span class="metric-label">M√©triques persist√©es</span>
                </div>
                <div class="metric">
                    <span class="metric-value">9.5M</span>
                    <span class="metric-label">Points √©crits / sec</span>
                </div>
                <div class="metric">
                    <span class="metric-value">0</span>
                    <span class="metric-label">Downtime tol√©r√© pour le monitoring</span>
                </div>
            </div>
            <p><strong>Contexte</strong> : En grandissant, Uber a satur√© toutes les solutions de m√©triques
                existantes (Graphite, Prometheus). Ils avaient besoin d'une base de donn√©es de s√©ries temporelles
                (TSDB) capable de scaler horizontalement √† l'infini.</p>
            <p><strong>Transformation</strong> :</p>
            <ol style="margin: 10px 0; padding-left: 25px; color: var(--text);">
                <li><strong>M3 Project</strong> : Ils ont cr√©√© leur propre stack open-source "M3" pour agr√©ger et
                    stocker les m√©triques.</li>
                <li><strong>Distributed Tracing</strong> : Cr√©ation de <strong>Jaeger</strong> (donn√© √† la CNCF)
                    pour suivre chaque course Uber √† travers des milliers de microservices Go et Java.</li>
                <li><strong>Adaptive Sampling</strong> : On ne garde pas 100% des traces (trop cher), mais 100% des
                    traces en erreur et 1% des traces r√©ussies.</li>
            </ol>
            <p><strong>R√©sultat</strong> : Uber peut d√©tecter une anomalie sur le prix ou la disponibilit√© des
                chauffeurs en moins de 10 secondes partout dans le monde.</p>
        </div>

        <!-- Recall Box -->
        <div class="recall-box">
            <h4>üîÑ √Ä Retenir - Observability Mastery</h4>
            <ul>
                <li><strong>Don't Log Everything</strong> : Le stockage des logs co√ªte cher. Filtrez √† la source.
                </li>
                <li><strong>Tagging is King</strong> : Une m√©trique ou un log sans tags (env, service, version) est
                    inutile.</li>
                <li><strong>Dashboards Actionnables</strong> : Un dashboard doit r√©pondre √† "Est-ce que √ßa marche ?"
                    pas "Regarde ces jolis graphs".</li>
                <li><strong>OpenTelemetry</strong> : Utilisez le standard ouvert OTel pour ne pas √™tre bloqu√© chez
                    un fournisseur (Lock-in).</li>
            </ul>
        </div>

        <!-- OPENTELEMETRY -->
        <h3 style="color:#fff; margin-top:40px; margin-bottom:15px;">üåê C. OpenTelemetry - Le Standard Unifi√©</h3>
        <div class="module-intro">
            <p><strong>OpenTelemetry (OTel)</strong> est le standard CNCF (graduated project) pour l'instrumentation,
                la collecte et l'export de t√©l√©m√©trie (logs, metrics, traces). C'est la fusion de OpenTracing +
                OpenCensus.</p>
            <p><strong>Probl√®me r√©solu</strong> : Avant OTel, chaque vendor (Datadog, New Relic, Jaeger) avait son
                propre SDK.
                Changer de vendor = r√©√©crire toute l'instrumentation. OTel = <strong>vendor-neutral</strong>.</p>
        </div>

        <div class="grid2" style="margin-top:20px;">
            <div class="ref-card" style="border-color:#fdcb6e;">
                <h4>üìä Architecture OTel</h4>
                <ul class="dense-list">
                    <li><strong>Instrumentation</strong> : SDKs dans l'app (auto ou manuel)</li>
                    <li><strong>Collector</strong> : Agent qui re√ßoit, transforme, exporte</li>
                    <li><strong>Exporters</strong> : Envoie vers Jaeger, Prometheus, Datadog, etc.</li>
                    <li><strong>Context Propagation</strong> : Trace ID suit la requ√™te partout</li>
                </ul>
            </div>
            <div class="code">
                <div class="code-head"><span class="dot g"></span>otel-collector.yaml</div>
                <pre><span class="kw">receivers:</span>
  <span class="kw">otlp:</span>      <span class="comment"># Re√ßoit traces/metrics via gRPC</span>
    <span class="kw">protocols:</span>
      <span class="kw">grpc:</span>
        <span class="kw">endpoint:</span> 0.0.0.0:4317

<span class="kw">processors:</span>
  <span class="kw">batch:</span>     <span class="comment"># Agr√®ge avant export</span>
  <span class="kw">memory_limiter:</span>
    <span class="kw">limit_mib:</span> <span class="num">512</span>

<span class="kw">exporters:</span>
  <span class="kw">jaeger:</span>
    <span class="kw">endpoint:</span> jaeger:14250
  <span class="kw">prometheus:</span>
    <span class="kw">endpoint:</span> prometheus:9090</pre>
            </div>
        </div>

        <div class="grid2" style="margin-top:15px;">
            <div class="code">
                <div class="code-head"><span class="dot g"></span>Auto-instrumentation (Python)</div>
                <pre><span class="kw">from</span> opentelemetry <span class="kw">import</span> trace
<span class="kw">from</span> opentelemetry.sdk.trace <span class="kw">import</span> TracerProvider
<span class="kw">from</span> opentelemetry.sdk.trace.export <span class="kw">import</span> BatchSpanProcessor
<span class="kw">from</span> opentelemetry.exporter.otlp.proto.grpc.trace_exporter <span class="kw">import</span> OTLPSpanExporter

<span class="comment"># Setup tracer</span>
trace.<span class="fn">set_tracer_provider</span>(TracerProvider())
tracer = trace.<span class="fn">get_tracer</span>(__name__)

<span class="comment"># Export vers Collector</span>
otlp_exporter = <span class="fn">OTLPSpanExporter</span>(endpoint=<span class="str">"localhost:4317"</span>)
span_processor = <span class="fn">BatchSpanProcessor</span>(otlp_exporter)
trace.<span class="fn">get_tracer_provider</span>().<span class="fn">add_span_processor</span>(span_processor)</pre>
            </div>
            <div class="info" style="border-left-color:#fdcb6e;">
                <strong>üîÑ Sampling Strategies</strong><br>
                <strong>Head-based</strong> : D√©cision au d√©but de la trace (1% de tout)<br>
                <strong>Tail-based</strong> : D√©cision √† la fin (100% des erreurs, 1% du succ√®s)<br>
                Tail-based est plus intelligent mais plus co√ªteux en compute.
            </div>
        </div>

        <!-- EBPF FOR OBSERVABILITY -->
        <h3 style="color:#fff; margin-top:40px; margin-bottom:15px;">üî¨ D. eBPF for Observability</h3>
        <div class="module-intro">
            <p><strong>eBPF</strong> (extended Berkeley Packet Filter) permet d'ex√©cuter du code dans le kernel Linux
                sans modifier le kernel. C'est r√©volutionnaire pour l'observabilit√© : <strong>zero
                    instrumentation</strong>.</p>
        </div>

        <div class="grid2">
            <div class="ref-card">
                <h4>ü¶Ö Pixie (eBPF-based Observability)</h4>
                <p style="margin-bottom:10px;">Observabilit√© automatique de K8s sans changer une ligne de code.</p>
                <ul class="dense-list">
                    <li>Capture automatique HTTP/gRPC/MySQL/Postgres requests</li>
                    <li>Cartes de d√©pendances g√©n√©r√©es automatiquement</li>
                    <li>Flamegraphs CPU sans profiler SDK</li>
                    <li>Deploy : <code>kubectl apply -f pixie.yaml</code></li>
                </ul>
            </div>
            <div class="ref-card" style="border-color:#fdcb6e;">
                <h4>üîç Avantages eBPF</h4>
                <ul class="dense-list">
                    <li><strong>Zero overhead</strong> : Pas de sidecars, pas de SDK</li>
                    <li><strong>Language-agnostic</strong> : Fonctionne avec Java, Go, Rust, C++</li>
                    <li><strong>Kernel-level visibility</strong> : Voit TOUT (syscalls, network packets)</li>
                    <li><strong>Security</strong> : Falco utilise eBPF pour d√©tecter intrusions</li>
                </ul>
            </div>
        </div>

        <div class="warning" style="margin-top:15px;">
            <strong>‚ö†Ô∏è Limite eBPF</strong><br>
            eBPF ne capture pas le <strong>contexte business</strong> (user ID, transaction ID). Pour cela,
            vous devez quand m√™me instrumenter manuellement avec OTel ou des logs structur√©s.
        </div>

        <!-- SLI/SLO/SLA -->
        <h3 style="color:#fff; margin-top:40px; margin-bottom:15px;">üéØ E. SLI/SLO/Error Budgets</h3>
        <div class="comparison-container">
            <div class="comparison-table" style="grid-template-columns: 1fr 1fr 1fr;">
                <div class="comparison-col">
                    <h4>üìè SLI (Indicator)</h4>
                    <p style="font-size:0.85rem; margin-bottom:8px;"><strong>Quoi ?</strong> M√©trique quantifiable de la
                        qualit√© du service.</p>
                    <p style="font-size:0.85rem; color:var(--muted);">Exemples : Latency P99, Success rate, Throughput
                    </p>
                    <p style="font-size:0.85rem; margin-top:8px;">Mesure CE QUI SE PASSE r√©ellement.</p>
                </div>
                <div class="comparison-col winner">
                    <h4>üéØ SLO (Objective)</h4>
                    <p style="font-size:0.85rem; margin-bottom:8px;"><strong>Quoi ?</strong> Target pour un SLI sur une
                        p√©riode.</p>
                    <p style="font-size:0.85rem; color:var(--muted);">Exemples : "99.9% des requ√™tes < 200ms sur 30
                            jours"</p>
                            <p style="font-size:0.85rem; margin-top:8px;">D√©finit CE QU'ON VEUT atteindre.</p>
                </div>
                <div class="comparison-col">
                    <h4>üìú SLA (Agreement)</h4>
                    <p style="font-size:0.85rem; margin-bottom:8px;"><strong>Quoi ?</strong> Contrat l√©gal avec
                        p√©nalit√©s financi√®res.</p>
                    <p style="font-size:0.85rem; color:var(--muted);">Exemples : "99.95% uptime ou remboursement"</p>
                    <p style="font-size:0.85rem; margin-top:8px;">Engage la RESPONSABILIT√â juridique.</p>
                </div>
            </div>
        </div>

        <div class="grid2" style="margin-top:20px;">
            <div>
                <h4 style="color:#fdcb6e; margin-bottom:15px;">üí∞ Error Budget</h4>
                <p style="margin-bottom:10px;">Si SLO = 99.9% uptime, alors Error Budget = <strong>0.1% downtime
                        autoris√©</strong> = 43 minutes/mois.</p>
                <ul class="dense-list">
                    <li>Budget consomm√© ‚Üí Freeze features, focus stabilit√©</li>
                    <li>Budget restant ‚Üí OK pour d√©ployer features risqu√©es</li>
                    <li>Alignement Dev/SRE : m√™me m√©trique, m√™me objectif</li>
                </ul>
                <div class="tip" style="margin-top:10px;">
                    Formule : <code>Error Budget = (1 - SLO) √ó p√©riode</code><br>
                    Ex: (1 - 0.999) √ó 30 jours √ó 24h √ó 60min = 43.2 minutes
                </div>
            </div>
            <div class="code">
                <div class="code-head"><span class="dot g"></span>SLO Burn Rate Alerting</div>
                <pre><span class="comment"># Alerte si on consomme Error Budget trop vite</span>
<span class="kw">alert:</span> ErrorBudgetBurn
<span class="kw">expr:</span> |
  (
    <span class="num">1</span> - <span class="fn">sum</span>(<span class="fn">rate</span>(http_requests_total{status=~<span class="str">"2.."</span>}[1h]))
        / <span class="fn">sum</span>(<span class="fn">rate</span>(http_requests_total[1h]))
  ) > (<span class="num">14.4</span> * (<span class="num">1</span> - <span class="num">0.999</span>))
  <span class="comment"># 14.4x = consomme budget en 2h au lieu de 30j</span>
<span class="kw">for:</span> 5m
<span class="kw">labels:</span>
  <span class="kw">severity:</span> critical
<span class="kw">annotations:</span>
  <span class="kw">summary:</span> <span class="str">"Burning error budget 14x faster"</span></pre>
            </div>
        </div>

        <!-- CARDINALITY -->
        <h3 style="color:#fff; margin-top:40px; margin-bottom:15px;">üí∏ F. Cardinality & Cost Management</h3>
        <div class="module-intro">
            <p><strong>Cardinality</strong> = nombre de combinaisons uniques de tags (labels).
                C'est LE probl√®me #1 qui fait exploser les co√ªts de monitoring.</p>
        </div>

        <div class="grid2">
            <div class="info" style="border-left-color:#ff7675;">
                <strong>üö® Explosion de Cardinality</strong><br>
                M√©trique : <code>http_requests{service, method, path, user_id, request_id}</code><br>
                Si 10 services √ó 5 methods √ó 1000 paths √ó 10M users √ó infinit√© request_id = üî•üí∏<br>
                <strong>Solution</strong> : JAMAIS mettre user_id ou request_id en tag. Utiliser des logs pour √ßa.
            </div>
            <div>
                <h4 style="color:#00b894; margin-bottom:15px;">‚úÖ Cardinality Best Practices</h4>
                <ul class="dense-list">
                    <li><strong>Low cardinality tags OK</strong> : env, service, region, status_code</li>
                    <li><strong>High cardinality tags NO</strong> : user_id, request_id, timestamp</li>
                    <li><strong>Agr√©gation intelligente</strong> : /users/123 ‚Üí /users/:id</li>
                    <li><strong>Monitoring de cardinality</strong> : Alerter si spike</li>
                </ul>
            </div>
        </div>

        <table class="cmd-table" style="margin-top:20px;">
            <thead>
                <tr>
                    <th>Strat√©gie</th>
                    <th>Co√ªt</th>
                    <th>Granularit√©</th>
                    <th>Use Case</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>100% des m√©triques</td>
                    <td style="color:#ff7675;">$$$$</td>
                    <td style="color:#00b894;">Max</td>
                    <td>Dev/Staging uniquement</td>
                </tr>
                <tr>
                    <td>Sampling (10%)</td>
                    <td style="color:#fdcb6e;">$$</td>
                    <td style="color:#fdcb6e;">Moyen</td>
                    <td>Production standard</td>
                </tr>
                <tr>
                    <td>Tail-based (erreurs only)</td>
                    <td style="color:#00b894;">$</td>
                    <td style="color:#00b894;">Intelligent</td>
                    <td>Production optimis√©</td>
                </tr>
                <tr>
                    <td>Retention 7j vs 90j</td>
                    <td style="color:#00b894;">$ vs $$$</td>
                    <td>-</td>
                    <td>Compliance requirements</td>
                </tr>
            </tbody>
        </table>

        <!-- DISTRIBUTED TRACING ADVANCED -->
        <h3 style="color:#fff; margin-top:40px; margin-bottom:15px;">üï∏Ô∏è G. Distributed Tracing Avanc√©</h3>
        <div class="grid2">
            <div class="code">
                <div class="code-head"><span class="dot g"></span>Trace Context Propagation (W3C)</div>
                <pre><span class="comment"># Headers HTTP propag√©s automatiquement</span>
traceparent: <span class="str">00-4bf92f3577b34da6a3ce929d0e0e4736-00f067aa0ba902b7-01</span>
             <span class="comment">‚îÇ  ‚îÇ                                ‚îÇ                ‚îÇ</span>
             <span class="comment">‚îÇ  ‚îî‚îÄ Trace ID (128-bit)           ‚îÇ                ‚îî‚îÄ Sampled?</span>
             <span class="comment">‚îÇ                                   ‚îî‚îÄ Span ID (64-bit)</span>
             <span class="comment">‚îî‚îÄ Version</span>

<span class="comment"># Chaque service ajoute son span √† la trace</span>
<span class="kw">GET</span> /api/orders ‚Üí <span class="fn">create_span</span>(<span class="str">"fetch_order"</span>) {
  <span class="kw">call</span> payment_service  <span class="comment"># Passe traceparent</span>
  <span class="kw">call</span> inventory_service <span class="comment"># Passe traceparent</span>
}</pre>
            </div>
            <div>
                <h4 style="color:#fdcb6e; margin-bottom:15px;">üè∑Ô∏è Span Tags & Baggage</h4>
                <ul class="dense-list">
                    <li><strong>Tags</strong> : Metadata du span (http.method, db.statement)</li>
                    <li><strong>Baggage</strong> : Key-value propag√©s √† TOUS les spans enfants</li>
                    <li><strong>Use case baggage</strong> : user_tier (premium/free) pour sampling</li>
                    <li><strong>Warning</strong> : Baggage augmente taille des headers ‚Üí latency</li>
                </ul>
                <div class="tip" style="margin-top:10px;">
                    <strong>Correlation avec logs</strong> : Injectez trace_id dans vos logs structur√©s
                    pour naviguer de la trace vers les logs d'un span sp√©cifique.
                </div>
            </div>
        </div>

        <!-- OBSERVABILITY PLATFORMS -->
        <h3 style="color:#fff; margin-top:40px; margin-bottom:15px;">üè¢ H. Observability Platforms Comparison</h3>
        <table class="cmd-table">
            <thead>
                <tr>
                    <th>Platform</th>
                    <th>Type</th>
                    <th>Forces</th>
                    <th>Faiblesses</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Datadog</strong></td>
                    <td>Commercial (SaaS)</td>
                    <td>All-in-one, APM excellent, UX top</td>
                    <td style="color:#ff7675;">Tr√®s cher (cardinality pricing)</td>
                </tr>
                <tr>
                    <td><strong>Grafana Stack</strong></td>
                    <td>Open-source</td>
                    <td>Loki (logs), Tempo (traces), Mimir (metrics), gratuit</td>
                    <td style="color:#fdcb6e;">Self-hosted = ops overhead</td>
                </tr>
                <tr>
                    <td><strong>Elastic (ELK)</strong></td>
                    <td>Open-core</td>
                    <td>Search puissant, mature, large √©cosyst√®me</td>
                    <td style="color:#fdcb6e;">Ressource hungry (Java heap)</td>
                </tr>
                <tr>
                    <td><strong>New Relic</strong></td>
                    <td>Commercial (SaaS)</td>
                    <td>Ingestion illimit√©e, pricing par user</td>
                    <td style="color:#fdcb6e;">Query language moins flexible</td>
                </tr>
                <tr>
                    <td><strong>Honeycomb</strong></td>
                    <td>Commercial (SaaS)</td>
                    <td>High-cardinality native, best pour debug</td>
                    <td style="color:#ff7675;">Focus traces uniquement</td>
                </tr>
            </tbody>
        </table>

        <!-- SHOPIFY CASE STUDY -->
        <div class="case-study" style="margin-top:30px;">
            <h4>üìä Cas d'√©tude : Shopify - Migration vers OpenTelemetry</h4>
            <div class="case-metrics">
                <div class="metric">
                    <span class="metric-value">1000+</span>
                    <span class="metric-label">Services instrument√©s</span>
                </div>
                <div class="metric">
                    <span class="metric-value">6 mois</span>
                    <span class="metric-label">Dur√©e migration compl√®te</span>
                </div>
                <div class="metric">
                    <span class="metric-value">-40%</span>
                    <span class="metric-label">R√©duction co√ªt observabilit√©</span>
                </div>
            </div>
            <p><strong>Contexte</strong> : Shopify utilisait un mix de Datadog SDK + custom instrumentation.
                Changer de vendor = 6 mois de refactoring. Inacceptable.</p>
            <p><strong>Migration OTel</strong> :</p>
            <ol style="margin: 10px 0; padding-left: 25px; color: var(--text);">
                <li><strong>Phase 1</strong> : Deploy OTel Collector en sidecar (sans changer app code)</li>
                <li><strong>Phase 2</strong> : Auto-instrumentation pour Ruby/Go (80% du backend)</li>
                <li><strong>Phase 3</strong> : Migration des custom spans vers OTel SDK</li>
                <li><strong>Phase 4</strong> : Multi-vendor export (Datadog + Honeycomb pour A/B test)</li>
            </ol>
            <p><strong>R√©sultat</strong> : Vendor-agnostic. Peut changer de backend observability sans toucher au code.
                Co√ªt r√©duit de 40% en optimisant sampling.</p>
        </div>

        <!-- AIRBNB CASE STUDY -->
        <div class="case-study">
            <h4>üìä Cas d'√©tude : Airbnb - Cardinality Explosion Incident</h4>
            <div class="case-metrics">
                <div class="metric">
                    <span class="metric-value">10M</span>
                    <span class="metric-label">M√©triques uniques cr√©√©es en 1h</span>
                </div>
                <div class="metric">
                    <span class="metric-value">$50K</span>
                    <span class="metric-label">Surco√ªt Datadog ce mois-l√†</span>
                </div>
                <div class="metric">
                    <span class="metric-value">3h</span>
                    <span class="metric-label">Dashboard Prometheus down</span>
                </div>
            </div>
            <p><strong>Contexte</strong> : Un d√©veloppeur a ajout√© un tag <code>listing_id</code> (7M valeurs uniques)
                √† une m√©trique de latency.</p>
            <p><strong>Impact imm√©diat</strong> :</p>
            <ol style="margin: 10px 0; padding-left: 25px; color: var(--text);">
                <li>Prometheus TSDB satur√©e ‚Üí toutes les queries timeoutent</li>
                <li>Datadog facture 10M nouvelles m√©triques √ó $0.05 = $500K/an projet√©</li>
                <li>Alertes cass√©es ‚Üí √©quipes aveugles pendant 3h</li>
            </ol>
            <p><strong>Fix</strong> : Tag <code>listing_id</code> supprim√©. Remplac√© par aggregation dans logs.
                Ajout de <strong>cardinality guard</strong> : CI bloque si une m√©trique a >1000 combinaisons de tags.
            </p>
            <p><strong>Le√ßon</strong> : La cardinality peut d√©truire votre observability ET votre budget. Reviewez les
                tags comme du code critique.</p>
        </div>

        <!-- Recall Box -->
        <div class="recall-box">
            <h4>üîÑ √Ä Retenir - Observability Mastery</h4>
            <ul>
                <li><strong>Don't Log Everything</strong> : Le stockage des logs co√ªte cher. Filtrez √† la source.
                </li>
                <li><strong>Tagging is King</strong> : Une m√©trique ou un log sans tags (env, service, version) est
                    inutile.</li>
                <li><strong>Dashboards Actionnables</strong> : Un dashboard doit r√©pondre √† "Est-ce que √ßa marche ?"
                    pas "Regarde ces jolis graphs".</li>
                <li><strong>OpenTelemetry</strong> : Utilisez le standard ouvert OTel pour ne pas √™tre bloqu√© chez
                    un fournisseur (Lock-in).</li>
                <li><strong>eBPF = Future</strong> : Observabilit√© zero-instrumentation au niveau kernel (Pixie, Falco).
                </li>
                <li><strong>SLO/Error Budgets</strong> : Alignez Dev et SRE sur des m√©triques business objectives.</li>
                <li><strong>Cardinality = Enemy #1</strong> : High-cardinality tags explosent les co√ªts et cassent les
                    TSDB.</li>
                <li><strong>Sampling intelligent</strong> : Tail-based sampling = 100% erreurs + 1% succ√®s = best ROI.
                </li>
            </ul>
        </div>


        <!-- PROMQL EXAMPLES -->
        <div class="grid2" style="margin-top:25px;">
            <div class="code">
                <div class="code-head"><span class="dot g"></span>PromQL Essentiels</div>
                <pre><span class="c"># Taux d'erreurs HTTP (5xx)</span>
<span class="fn">rate</span>(http_requests_total{status=~"5.."}[5m])
  / <span class="fn">rate</span>(http_requests_total[5m])

<span class="c"># Latence P99</span>
<span class="fn">histogram_quantile</span>(0.99,
  <span class="fn">rate</span>(http_duration_seconds_bucket[5m]))

<span class="c"># CPU usage par pod</span>
<span class="fn">sum by</span>(pod)(rate(container_cpu_usage_seconds_total[5m]))</pre>
            </div>
            <div>
                <h4 style="color:#fdcb6e; margin-bottom:15px;">üö® Alerting Best Practices</h4>
                <ul class="dense-list">
                    <li><strong>SLO-based</strong> : Alerter sur Error Budget burn rate</li>
                    <li><strong>Pas trop d'alertes</strong> : Alert fatigue = tout ignorer</li>
                    <li><strong>Runbooks</strong> : Chaque alerte ‚Üí action claire</li>
                    <li><strong>Escalation</strong> : PagerDuty, OpsGenie</li>
                </ul>
                <div class="tip" style="margin-top:15px;">
                    <strong>Correlation ID</strong> : Injectez un ID unique dans logs, metrics et traces pour les
                    relier.
                </div>
            </div>
        </div>
    </div>
</section>