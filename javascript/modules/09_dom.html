<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM - M√©mo JavaScript</title>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        .dom-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .dom-card {
            background: var(--card);
            padding: 18px;
            border-radius: 10px;
            border: 1px solid var(--border);
            transition: transform 0.2s;
        }

        .dom-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        .dom-title {
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.05rem;
            font-family: 'JetBrains Mono';
        }

        .perf-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-top: 8px;
        }

        .perf-fast {
            background: #4caf50;
            color: white;
        }

        .perf-slow {
            background: #f44336;
            color: white;
        }

        .builder {
            background: var(--bg2);
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .builder-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .builder-btn {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-weight: 500;
        }

        .builder-btn:hover {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        .builder-preview {
            background: var(--bg);
            padding: 20px;
            border-radius: 8px;
            min-height: 150px;
            border: 2px dashed var(--border);
        }

        .perf-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .perf-side {
            background: var(--card);
            padding: 15px;
            border-radius: 8px;
        }

        .perf-side.bad {
            border: 2px solid #f44336;
        }

        .perf-side.good {
            border: 2px solid #4caf50;
        }

        @media(max-width: 700px) {
            .perf-demo {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <main class="container">
        <section id="s9" style="border:none; padding-top:40px">
            <div class="sec-header">
                <div class="sec-num">09</div>
                <div>
                    <h2 class="sec-title">DOM Manipulation</h2>
                    <p class="sec-sub">S√©lection, Modification & Performance</p>
                </div>
            </div>

            <p>Le DOM (Document Object Model) est l'interface JavaScript pour manipuler le HTML. Ma√Ætriser le DOM est
                essentiel pour cr√©er des interfaces dynamiques.</p>

            <!-- SELECTION METHODS -->
            <h3 style="margin-top:30px; border-left: 4px solid var(--primary); padding-left: 12px;">üéØ M√©thodes de
                S√©lection</h3>

            <div class="dom-grid">
                <div class="dom-card">
                    <div class="dom-title">querySelector()</div>
                    <pre style="margin:10px 0"><code class="language-javascript">// Premier √©l√©ment trouv√©
const btn = document.querySelector('.btn');
const title = document.querySelector('#title');

// S√©lecteur CSS complexe
const first = document.querySelector('ul > li:first-child');</code></pre>
                    <span class="perf-badge perf-fast">‚ö° Rapide</span>
                </div>

                <div class="dom-card">
                    <div class="dom-title">querySelectorAll()</div>
                    <pre style="margin:10px 0"><code class="language-javascript">// Tous les √©l√©ments (NodeList)
const items = document.querySelectorAll('.item');

// ‚ö†Ô∏è Pas un Array ! Convertir :
const arr = Array.from(items);
arr.forEach(item => {...});</code></pre>
                    <span class="perf-badge perf-fast">‚ö° Rapide</span>
                </div>

                <div class="dom-card">
                    <div class="dom-title">getElementById()</div>
                    <pre style="margin:10px 0"><code class="language-javascript">// Par ID (sans #)
const el = document.getElementById('myId');

// ‚úÖ Plus rapide que querySelector
// ‚ùå Moins flexible</code></pre>
                    <span class="perf-badge perf-fast">‚ö°‚ö° Tr√®s rapide</span>
                </div>

                <div class="dom-card">
                    <div class="dom-title">Traversal (Navigation)</div>
                    <pre style="margin:10px 0"><code class="language-javascript">const el = document.querySelector('.item');

el.parentElement;     // Parent
el.children;          // Enfants
el.nextElementSibling; // Suivant
el.previousElementSibling; // Pr√©c√©dent</code></pre>
                </div>
            </div>

            <!-- MANIPULATION -->
            <h3 style="margin-top:40px;">üîß Manipulation du DOM</h3>

            <div class="dom-grid">
                <div class="dom-card">
                    <div class="dom-title">createElement()</div>
                    <pre style="margin:10px 0"><code class="language-javascript">const div = document.createElement('div');
div.className = 'box';
div.textContent = 'Hello';

document.body.appendChild(div);</code></pre>
                </div>

                <div class="dom-card">
                    <div class="dom-title">classList API</div>
                    <pre style="margin:10px 0"><code class="language-javascript">const el = document.querySelector('.box');

el.classList.add('active');
el.classList.remove('hidden');
el.classList.toggle('dark');
el.classList.contains('active'); // true</code></pre>
                </div>

                <div class="dom-card">
                    <div class="dom-title">Attributes</div>
                    <pre style="margin:10px 0"><code class="language-javascript">const img = document.querySelector('img');

img.getAttribute('src');
img.setAttribute('alt', 'Photo');
img.dataset.userId = '123'; // data-user-id

// Acc√®s direct
img.src = 'new.jpg';</code></pre>
                </div>

                <div class="dom-card">
                    <div class="dom-title">innerHTML vs textContent</div>
                    <pre style="margin:10px 0"><code class="language-javascript">const div = document.querySelector('div');

// ‚ö†Ô∏è innerHTML : Parse HTML (XSS risk)
div.innerHTML = '<strong>Bold</strong>';

// ‚úÖ textContent : Texte brut (safe)
div.textContent = 'Plain text';</code></pre>
                </div>
            </div>

            <!-- PERFORMANCE -->
            <h3 style="margin-top:40px;">‚ö° Optimisation Performance</h3>
            <div class="perf-demo">
                <div class="perf-side bad">
                    <div style="color:#f44336; font-weight:bold; margin-bottom:10px">‚ùå Lent (Reflow √† chaque it√©ration)
                    </div>
                    <pre><code class="language-javascript">// ‚ùå Mauvais : 1000 reflows
for (let i = 0; i < 1000; i++) {
    const div = document.createElement('div');
    div.textContent = i;
    document.body.appendChild(div);
}

// Chaque appendChild d√©clenche
// un recalcul du layout !</code></pre>
                </div>

                <div class="perf-side good">
                    <div style="color:#4caf50; font-weight:bold; margin-bottom:10px">‚úÖ Rapide (1 seul reflow)</div>
                    <pre><code class="language-javascript">// ‚úÖ Bon : DocumentFragment
const fragment = document.createDocumentFragment();

for (let i = 0; i < 1000; i++) {
    const div = document.createElement('div');
    div.textContent = i;
    fragment.appendChild(div);
}

document.body.appendChild(fragment);
// 1 seul reflow !</code></pre>
                </div>
            </div>

            <div class="code-container">
                <div class="code-header-mac"><span class="dot red"></span><span class="dot yellow"></span><span
                        class="dot green"></span></div>
                <pre><code class="language-javascript">// Autres optimisations

// 1. Batch les modifications de style
el.style.cssText = 'width: 100px; height: 100px; background: red;';
// Mieux que 3 lignes s√©par√©es

// 2. Cache les s√©lections
const items = document.querySelectorAll('.item'); // 1 fois
items.forEach(item => item.classList.add('active'));
// Pas de querySelector dans la boucle !

// 3. Utilise classList au lieu de className
el.classList.add('active'); // ‚úÖ
el.className += ' active';  // ‚ùå (remplace tout)

// 4. Event Delegation (voir module Events)
document.addEventListener('click', e => {
    if (e.target.matches('.btn')) {
        // Handle click
    }
});</code></pre>
            </div>

            <!-- INTERACTIVE BUILDER -->
            <div class="builder">
                <h3 style="margin-top:0; color:var(--accent)">üèóÔ∏è DOM Builder Interactif</h3>
                <p style="opacity:0.8; margin-bottom:20px">Cr√©ez des √©l√©ments dynamiquement et voyez le r√©sultat.</p>

                <div class="builder-controls">
                    <div class="builder-btn" onclick="addElement('div', 'Box')">+ Div</div>
                    <div class="builder-btn" onclick="addElement('p', 'Paragraphe')">+ Paragraph</div>
                    <div class="builder-btn" onclick="addElement('button', 'Bouton')">+ Button</div>
                    <div class="builder-btn" onclick="addElement('input', '')">+ Input</div>
                    <div class="builder-btn" onclick="toggleClass()">Toggle Class</div>
                    <div class="builder-btn" onclick="clearBuilder()">üóëÔ∏è Clear</div>
                </div>

                <div id="builder-preview" class="builder-preview">
                    <div style="opacity:0.5; text-align:center">Cliquez sur les boutons pour construire</div>
                </div>

                <div id="builder-code"
                    style="background:var(--bg); padding:15px; border-radius:8px; margin-top:15px; font-family:'JetBrains Mono'; font-size:0.85rem; min-height:60px">
                    <div style="opacity:0.5">Code g√©n√©r√©...</div>
                </div>
            </div>

            <div class="tip">
                <strong>Best Practice :</strong> Utilisez <code>DocumentFragment</code> pour les insertions multiples.
                Pr√©f√©rez <code>textContent</code> √† <code>innerHTML</code> pour √©viter les failles XSS. Cachez les
                s√©lections DOM hors des boucles.
            </div>

            <div style="margin-top:40px; display:flex; gap:10px">
                <a href="08_objects.html" class="demo-btn" style="text-decoration:none; background:var(--bg2)">‚Üê
                    Objects</a>
                <a href="10_events.html" class="demo-btn" style="text-decoration:none">Suivant: Events ‚Üí</a>
            </div>
        </section>
    </main>

    <script src="../assets/js/layout.js"></script>
    <script src="../assets/js/modules/09_dom.js"></script>
</body>

</html>