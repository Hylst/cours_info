<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÃ©mo Node.js - Backend JavaScript | Guide 2025</title>
    <base href="/cours/docker/node_js/">

    <meta name="description"
        content="Guide Node.js : Event Loop, Modules, File System, HTTP, Express.js. DÃ©mos interactives et syntaxe moderne.">
    <meta name="keywords" content="Node.js, Backend, JavaScript, Express, Server, API, NPM, Modules">
    <meta name="author" content="Geoffroy Streit">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#303030">
    <link rel="canonical" href="index.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="MÃ©mo Node.js - Backend JavaScript">
    <meta property="og:description" content="Guide Node.js : Event Loop, Modules, File System, HTTP, Express.js.">
    <meta property="og:url" content="https://hylst.fr/cours/docker/node_js/index.html">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:image" content="https://hylst.fr/cours/docker/assets/img/nodejs-share.webp">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="MÃ©mo Node.js - Backend JavaScript">
    <meta name="twitter:description" content="Guide Node.js : Event Loop, Modules, File System, HTTP, Express.js.">
    <meta name="twitter:image" content="https://hylst.fr/cours/docker/assets/img/nodejs-share.webp">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/quiz-style.css">
    <link rel="stylesheet" href="style.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../assets/img/icons/favicon.ico">
</head>

<body>

    <header>
        <div class="container header-content">
            <div class="logo">
                <div class="logo-icon">JS</div>Node.js
            </div>
            <button class="mobile-menu-btn" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav class="nav-menu">
                <a href="#s1">Intro</a>
                <a href="#s2">Modules</a>
                <a href="#s3">FS</a>
                <a href="#s4">Events</a>
                <a href="#s5">HTTP</a>
                <a href="#s6">Express</a>
                <a href="#s9">AvancÃ©</a>
                <a href="#quiz-section" class="quiz-btn">Quiz</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>MÃ©mo Node.js</h1>
            <p>JavaScript cÃ´tÃ© serveur. Runtime asynchrone orientÃ© Ã©vÃ©nements.</p>
        </div>
    </section>

    <!-- INTRO GENERAL -->
    <div class="intro-box">
        <div class="container">
            <div class="grid2">
                <div>
                    <h3>Qu'est-ce que Node.js ?</h3>
                    <p style="max-width:800px;">
                        Node.js est un <strong>Runtime</strong> JavaScript bÃ¢ti sur le moteur <strong>V8</strong> de
                        Chrome.
                        Il permet de porter la puissance du Web cÃ´tÃ© serveur avec une approche unifiÃ©e.
                    </p>
                    <p style="color:var(--muted); font-size:0.95rem; margin-top:10px">
                        CrÃ©Ã© par <strong>Ryan Dahl</strong> en 2009, il a rÃ©volutionnÃ© le backend en prouvant qu'un
                        modÃ¨le
                        asynchrone basÃ© sur les Ã©vÃ©nements peut surpasser les modÃ¨les multi-threadÃ©s classiques pour les
                        entrÃ©es/sorties (I/O).
                    </p>
                </div>
                <div class="ref-card" style="border:1px solid var(--primary); background:rgba(104, 160, 99, 0.05)">
                    <h4>Les piliers</h4>
                    <ul style="font-size:0.85rem; line-height:1.6">
                        <li>ğŸš€ <strong>V8</strong> : Vitesse d'exÃ©cution quasi-native</li>
                        <li>ğŸ§µ <strong>Asynchrone</strong> : Rien n'est bloquant (par dÃ©faut)</li>
                        <li>ğŸ“¦ <strong>NPM</strong> : Le plus grand Ã©cosystÃ¨me au monde</li>
                        <li>ğŸ”„ <strong>JSON</strong> : Langage natif de bout en bout</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="toc">
        <div class="container">
            <div class="toc-grid">
                <a href="#s1" class="toc-item"><span class="toc-num">01</span>Runtime & Async</a>
                <a href="#s2" class="toc-item"><span class="toc-num">02</span>Modules (CJS/ESM)</a>
                <a href="#s3" class="toc-item"><span class="toc-num">03</span>File System (fs)</a>
                <a href="#s4" class="toc-item"><span class="toc-num">04</span>Events (Emitter)</a>
                <a href="#s5" class="toc-item"><span class="toc-num">05</span>HTTP Server</a>
                <a href="#s6" class="toc-item"><span class="toc-num">06</span>Express.js</a>
                <a href="#s7" class="toc-item"><span class="toc-num">07</span>NPM & Scripts</a>
                <a href="#s8" class="toc-item"><span class="toc-num">08</span>Variables d'Env</a>
                <a href="#s9" class="toc-item"><span class="toc-num">09</span>Streams & Buffers</a>
                <a href="#s10" class="toc-item"><span class="toc-num">10</span>Error Handling</a>
                <a href="#s11" class="toc-item"><span class="toc-num">11</span>OS & Process</a>
            </div>
        </div>
    </div>
    <!-- S1: RUNTIME -->
    <section id="s1">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">01</div>
                <div>
                    <h2 class="sec-title">Runtime & Async</h2>
                    <p class="sec-sub">Event Loop, Libuv & Architecture Non-Bloquante</p>
                </div>
            </div>

            <div class="grid2">
                <div>
                    <h3>Architecture Node.js</h3>
                    <p>Node.js combine le moteur <strong>V8</strong> (Chrome) avec <strong>Libuv</strong>.</p>
                    <ul style="margin-top:10px; line-height:1.6; color:var(--muted)">
                        <li><strong>V8 Engine</strong> : Compile et exÃ©cute le JS.</li>
                        <li><strong>Libuv</strong> : GÃ¨re l'Event Loop, les Thread Pool (pour I/O lourds) et les
                            Ã©vÃ©nements
                            systÃ¨me.</li>
                        <li><strong>Single Threaded</strong> : Un seul stack d'exÃ©cution JS (Main Thread).</li>
                    </ul>
                </div>
                <div class="warning">
                    <strong>âš ï¸ Don't Block the Loop !</strong><br>
                    Le JSON.parse d'un fichier de 100MB ou une boucle `while(true)` bloquera TOUS les utilisateurs. Pour
                    du
                    calcul lourd, utilisez les <strong>Worker Threads</strong>.
                </div>
            </div>

            <details open>
                <summary>ğŸ’¡ Deep Dive: L'Event Loop</summary>
                <div class="details-content">
                    <p>L'Event Loop orchestre tout. Elle tourne en boucle et passe par diffÃ©rentes
                        <strong>Phases</strong> :
                    </p>

                    <div
                        style="background:var(--bg); padding:15px; border-radius:8px; margin:15px 0; font-family:monospace; border:1px solid var(--border);">
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>
                        â”‚ Timers (setTimeout) â”‚ â—€â”€â”€ Le callback est exÃ©cutÃ© ici<br>
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>
                        â”‚<br>
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>
                        â”‚ Pending Callbacks â”‚ â—€â”€â”€ Erreurs systÃ¨me (OS)<br>
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>
                        â”‚<br>
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>
                        â”‚ Idle, Prepare â”‚ â—€â”€â”€ Usage interne<br>
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>
                        â”‚<br>
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>
                        â”‚ POLL â”‚ â—€â”€â”€ ğŸš¨ LE COEUR : I/O, FS, Network<br>
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>
                        â”‚<br>
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>
                        â”‚ Check (setImmediate) â”‚ â—€â”€â”€ ExÃ©cutÃ© juste aprÃ¨s Poll<br>
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>
                        â”‚<br>
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>
                        â”‚ Close Callbacks â”‚ â—€â”€â”€ socket.on('close', ...)<br>
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </div>

                    <h4 style="color:var(--accent); margin-top:20px;">Microtasks vs Macrotasks</h4>
                    <p>Entre chaque phase, Node.js vide DEUX queues prioritaires :</p>
                    <ol>
                        <li><strong>process.nextTick()</strong> : PrioritÃ© ABSOLUE. S'exÃ©cute immÃ©diatement aprÃ¨s le
                            code
                            courant, avant mÃªme les promesses. âš ï¸ Danger de boucle infinie.</li>
                        <li><strong>Promise (Microtasks)</strong> : S'exÃ©cute aprÃ¨s nextTick, avant de passer Ã  la phase
                            suivante de l'Event Loop.</li>
                    </ol>
                </div>
            </details>

            <div class="code">
                <div class="code-head"><span class="dot r"></span>PrioritÃ© d'exÃ©cution (PiÃ¨ge Classique)</div>
                <pre><span class="fn">console</span>.<span class="fn">log</span>(<span class="str">"1. Start"</span>);

<span class="fn">setTimeout</span>(() => <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">"5. Timeout (Macrotask)"</span>), <span class="num">0</span>);

<span class="fn">setImmediate</span>(() => <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">"6. Check Phase"</span>));

<span class="kw">new</span> <span class="fn">Promise</span>(resolve => {
    <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">"2. Promise Init (Sync)"</span>);
    <span class="fn">resolve</span>();
}).<span class="fn">then</span>(() => <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">"4. Promise .then (Microtask)"</span>));

<span class="var">process</span>.<span class="fn">nextTick</span>(() => <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">"3. NextTick (Top Priority)"</span>));

<span class="fn">console</span>.<span class="fn">log</span>(<span class="str">"End Stack"</span>);

<span class="c">/* Ordre RÃ©el :
   1. Start
   2. Promise Init
   End Stack
   3. NextTick
   4. Promise .then
   5. Timeout
   6. Check Phase
*/</span></pre>
            </div>

            <div class="grid2">
                <div class="ref-card">
                    <h4>Worker Threads</h4>
                    <p style="font-size:0.9rem">Pour les tÃ¢ches CPU-Intensive (crypto, compression, traitement image).
                    </p>
                    <div class="code" style="margin:5px 0;">
                        <pre
                            style="padding:10px;"><span class="kw">import</span> { <span class="fn">Worker</span> } <span class="kw">from</span> <span class="str">'node:worker_threads'</span>;</pre>
                    </div>
                </div>
                <div class="ref-card">
                    <h4>Cluster Mode</h4>
                    <p style="font-size:0.9rem">Pour scaler sur plusieurs coeurs CPU (via PM2 ou module natif).</p>
                </div>
            </div>

            <div class="demo">
                <div class="demo-title">Simulateur Event Loop</div>
                <p style="font-size:0.85rem; margin-bottom:10px; opacity:0.8">Visualisez l'ordre d'exÃ©cution rÃ©el entre
                    les
                    diffÃ©rentes queues.</p>
                <button class="demo-btn" onclick="demoEventLoop()">Lancer simulation</button>
                <div id="demo-loop-output" class="demo-output">En attente...</div>
            </div>
        </div>
    </section>
    <!-- S2: MODULES -->
    <section id="s2">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">02</div>
                <div>
                    <h2 class="sec-title">Modules</h2>
                    <p class="sec-sub">CommonJS, ESM & Internals</p>
                </div>
            </div>

            <div class="tip">
                <strong>ğŸ’¡ Le Singleton</strong>
                Un module n'est exÃ©cutÃ© qu'une <strong>seule fois</strong>. Le rÃ©sultat est mis en cache.
                Au prochain `import`/`require`, Node retourne l'objet cached. Si vous modifiez l'objet exportÃ©, tous les
                autres fichiers verront la modification (Mutable).
            </div>

            <details>
                <summary>ğŸ” CommonJS (CJS) - Under the hood</summary>
                <div class="details-content">
                    <p>Quand Node exÃ©cute un fichier JS en CJS, il ne l'exÃ©cute pas "nu". Il l'enveloppe dans une
                        fonction
                        (IIFE) :</p>
                    <code
                        style="display:block; background:#000; padding:10px; margin:10px 0; border-radius:5px; color:#83cd29">
                        (function(exports, require, module, __filename, __dirname) {<br>
                        &nbsp;&nbsp;&nbsp;// Votre code vit ici<br>
                        });
                    </code>
                    <p>C'est pour cela que <code>__dirname</code>, <code>exports</code>, etc. sont disponibles
                        "globalement"
                        (mais en fait locaux Ã  la fonction).</p>
                </div>
            </details>

            <div class="grid2">
                <div class="code">
                    <div class="code-head">CommonJS (Legacy)</div>
                    <pre><span class="c">// export</span>
<span class="var">module</span>.<span class="var">exports</span> = { <span class="fn">hello</span> };

<span class="c">// import</span>
<span class="kw">const</span> <span class="var">lib</span> = <span class="fn">require</span>(<span class="str">'./lib'</span>);

<span class="c">// Dynamic Import (Possible)</span>
<span class="kw">if</span> (cond) <span class="fn">require</span>(<span class="str">'./opt'</span>);</pre>
                </div>

                <div class="code">
                    <div class="code-head">ES Modules (Standard)</div>
                    <pre><span class="c">// export</span>
<span class="kw">export</span> <span class="kw">default</span> <span class="kw">function</span>() {}
<span class="kw">export</span> <span class="kw">const</span> <span class="var">val</span> = <span class="num">42</span>;

<span class="c">// import</span>
<span class="kw">import</span> <span class="var">fn</span>, { <span class="var">val</span> } <span class="kw">from</span> <span class="str">'./lib.mjs'</span>;

<span class="c">// Top-level await (Cool!)</span>
<span class="kw">const</span> <span class="var">data</span> = <span class="kw">await</span> <span class="fn">fetch</span>(...);</pre>
                </div>
            </div>

            <h3 style="margin-top:30px; margin-bottom:15px; font-size:1.3rem;">ESM : Les piÃ¨ges classiques</h3>

            <div class="grid2">
                <div class="ref-card">
                    <h4>âŒ __dirname n'existe pas</h4>
                    <p>En ESM, `__dirname` n'est pas dÃ©fini.</p>
                    <pre
                        style="margin-top:5px; background:var(--bg); padding:8px;"><span class="c">// Remplacement :</span>
<span class="kw">import</span> { <span class="fn">fileURLToPath</span> } <span class="kw">from</span> <span class="str">'url'</span>;
<span class="kw">import</span> { <span class="fn">dirname</span> } <span class="kw">from</span> <span class="str">'path'</span>;

<span class="kw">const</span> <span class="var">__filename</span> = <span class="fn">fileURLToPath</span>(<span class="kw">import</span>.<span class="var">meta</span>.<span class="var">url</span>);
<span class="kw">const</span> <span class="var">__dirname</span> = <span class="fn">dirname</span>(<span class="var">__filename</span>);</pre>
                </div>

                <div class="ref-card">
                    <h4>âš ï¸ Extensions obligatoires</h4>
                    <p>En ESM natif, l'import relatif DOIT avoir l'extension.</p>
                    <pre
                        style="margin-top:5px; background:var(--bg); padding:8px;"><span class="c">// BAD</span>
<span class="kw">import</span> <span class="var">utils</span> <span class="kw">from</span> <span class="str">'./utils'</span>;

<span class="c">// GOOD</span>
<span class="kw">import</span> <span class="var">utils</span> <span class="kw">from</span> <span class="str">'./utils.js'</span>;</pre>
                </div>
            </div>

            <details>
                <summary>ğŸ”„ Cycles & DÃ©pendances Circulaires</summary>
                <div class="details-content">
                    <p>Si A importe B, et B importe A...</p>
                    <ul>
                        <li><strong>CJS</strong> : Retourne un objet export partiel (vide ou incomplet) pour casser la
                            boucle. Peut causer des crashs.</li>
                        <li><strong>ESM</strong> : GÃ¨re mieux les rÃ©fÃ©rences (Binding live), mais reste dangereux.</li>
                    </ul>
                    <p><strong>Solution</strong> : Refactoriser. Extraire la partie commune dans un Module C.</p>
                </div>
            </details>
        </div>
    </section>
    <!-- S3: FILE SYSTEM -->
    <section id="s3">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">03</div>
                <div>
                    <h2 class="sec-title">File System (fs)</h2>
                    <p class="sec-sub">Manipulation de fichiers & Chemins</p>
                </div>
            </div>

            <div class="grid2">
                <div class="code">
                    <div class="code-head"><span class="dot g"></span>Le module Path (Vital)</div>
                    <pre><span class="kw">import</span> <span class="var">path</span> <span class="kw">from</span> <span class="str">'node:path'</span>;

<span class="c">// âš ï¸ NE JAMAIS faire 'dir/file.txt' (Windows utilise \)</span>
<span class="c">// Toujours utiliser path.join()</span>
<span class="kw">const</span> <span class="var">filePath</span> = <span class="var">path</span>.<span class="fn">join</span>(<span class="str">'data'</span>, <span class="str">'logs'</span>, <span class="str">'error.log'</span>);
<span class="c">// -> "data/logs/error.log" (Linux)</span>
<span class="c">// -> "data\logs\error.log" (Windows)</span>

<span class="kw">const</span> <span class="var">abs</span> = <span class="var">path</span>.<span class="fn">resolve</span>(<span class="str">'config.json'</span>);
<span class="c">// -> Chemin absolu depuis racine process</span></pre>
                </div>

                <div class="intro-box" style="padding:15px; margin:0; border:1px solid var(--border);">
                    <h4>Les 3 modes d'accÃ¨s</h4>
                    <ul style="padding-left:20px; color:var(--muted)">
                        <li><strong style="color:#dba4a4">Sync</strong> (<code>readFileSync</code>) : Bloque tout le
                            thread.
                            Uniquement pour charger une config au dÃ©marrage.</li>
                        <li><strong style="color:var(--text)">Callback</strong> (<code>readFile</code>) : Legacy,
                            rapide,
                            mais verbeux.</li>
                        <li><strong style="color:var(--primary-bright)">Promise</strong> (<code>fs/promises</code>) : Le
                            standard moderne. Compatible async/await.</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin-top:30px;">Streaming (Big Files)</h3>
            <p style="margin-bottom:15px; color:var(--muted)">Pour les gros fichiers (ex: VidÃ©o, Log de 1GB), ne jamais
                tout
                charger en RAM !</p>

            <div class="code">
                <div class="code-head"><span class="dot r"></span>Lecture StreamÃ©e</div>
                <pre><span class="kw">import</span> <span class="var">fs</span> <span class="kw">from</span> <span class="str">'node:fs'</span>;

<span class="kw">const</span> <span class="var">stream</span> = <span class="var">fs</span>.<span class="fn">createReadStream</span>(<span class="str">'giant-video.mp4'</span>, { 
    <span class="var">highWaterMark</span>: <span class="num">64</span> * <span class="num">1024</span> <span class="c">// Lire par chunk de 64KB</span>
});

<span class="var">stream</span>.<span class="fn">on</span>(<span class="str">'data'</span>, (<span class="var">chunk</span>) => {
    <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">`ReÃ§u ${chunk.length} bytes`</span>);
    <span class="c">// Envoyer au client au fur et Ã  mesure...</span>
});

<span class="var">stream</span>.<span class="fn">on</span>(<span class="str">'end'</span>, () => <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">'TerminÃ©'</span>));</pre>
            </div>

            <div class="grid2">
                <div class="ref-card">
                    <h4>Dossiers & Arborescence</h4>
                    <p>Pour lister efficacement des dossiers gÃ©ants, utilisez <code>opendir</code> (ItÃ©rateur) plutÃ´t
                        que
                        <code>readdir</code> (Tableau complet).
                    </p>
                    <pre
                        style="margin-top:5px; font-size:0.8rem;"><span class="kw">const</span> <span class="var">dir</span> = <span class="kw">await</span> <span class="var">fs</span>.<span class="fn">opendir</span>(<span class="str">'./img'</span>);
<span class="kw">for</span> <span class="kw">await</span> (<span class="kw">const</span> <span class="var">dirent</span> <span class="kw">of</span> <span class="var">dir</span>)
  <span class="fn">console</span>.<span class="fn">log</span>(<span class="var">dirent</span>.<span class="var">name</span>);</pre>
                </div>

                <div class="ref-card">
                    <h4>Watch Mode</h4>
                    <p>Surveiller les changements de fichiers.</p>
                    <code style="color:var(--kw)">fs.watch('config.json', (evt, file) => reload())</code>
                </div>
            </div>

            <div class="demo">
                <div class="demo-title">Virtual File System</div>
                <button class="demo-btn" onclick="demoFSRead()">Lire Fichier</button>
                <button class="demo-btn" onclick="demoFSWrite()">Ã‰crire Fichier</button>
                <div id="demo-fs-output" class="demo-output">En attente d'opÃ©ration...</div>
            </div>
        </div>
    </section>
    <!-- S4: EVENTS -->
    <section id="s4">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">04</div>
                <div>
                    <h2 class="sec-title">Events</h2>
                    <p class="sec-sub">Architecture et Design Patterns</p>
                </div>
            </div>

            <div class="intro-box" style="padding:15px; margin:0; border:var(--border);">
                <h4>Architecture OrientÃ©e Ã‰vÃ©nements</h4>
                <p>Node.js est construit autour de l'observer pattern. Le core de Node (<code>net.Server</code>,
                    <code>fs.ReadStream</code>) Ã©met des Ã©vÃ©nements.
                </p>
            </div>

            <details>
                <summary>âš ï¸ Gestion des Fuites MÃ©moire (MaxListeners)</summary>
                <div class="details-content">
                    <p>Si vous attachez trop de listeners Ã  un mÃªme Ã©vÃ©nement (plus de 10 par dÃ©faut), Node.js vous
                        avertira
                        :</p>
                    <code
                        style="color:yellow">MaxListenersExceededWarning: Possible EventEmitter memory leak detected.</code>
                    <p>Pourquoi ? Si vous ajoutez un listener dans une boucle ou une requÃªte sans le retirer, ils
                        s'accumulent indÃ©finiment.</p>
                    <pre
                        style="margin-top:10px; background:#111; padding:5px;"><span class="var">myEmitter</span>.<span class="fn">setMaxListeners</span>(<span class="num">20</span>); <span class="c">// Augmenter la limite</span></pre>
                </div>
            </details>

            <div class="grid2">
                <div class="code">
                    <div class="code-head">MÃ©thodes clÃ©s</div>
                    <pre><span class="c">// 1. on() : Ã‰coute permanente</span>
<span class="var">emitter</span>.<span class="fn">on</span>(<span class="str">'data'</span>, <span class="var">cb</span>);

<span class="c">// 2. once() : Ã‰coute UNE SEULE fois</span>
<span class="var">emitter</span>.<span class="fn">once</span>(<span class="str">'init'</span>, () => <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">'DÃ©marrÃ©'</span>));

<span class="c">// 3. off() / removeListener() : ArrÃªter</span>
<span class="kw">const</span> <span class="fn">log</span> = (<span class="var">msg</span>) => <span class="fn">console</span>.<span class="fn">log</span>(<span class="var">msg</span>);
<span class="var">emitter</span>.<span class="fn">on</span>(<span class="str">'msg'</span>, <span class="fn">log</span>);
<span class="var">emitter</span>.<span class="fn">off</span>(<span class="str">'msg'</span>, <span class="fn">log</span>);</pre>
                </div>

                <div class="code">
                    <div class="code-head">ğŸš¨ L'Ã©vÃ©nement 'error'</div>
                    <pre style="border-left:3px solid red;">
<span class="c">// Si 'error' est Ã©mis SANS listener...</span>
<span class="c">// Node CRASH immÃ©diatement !</span>

<span class="var">myEmitter</span>.<span class="fn">on</span>(<span class="str">'error'</span>, (<span class="var">err</span>) => {
    <span class="fn">console</span>.<span class="fn">error</span>(<span class="str">'Erreur gÃ©rÃ©e :'</span>, <span class="var">err</span>);
});

<span class="var">myEmitter</span>.<span class="fn">emit</span>(<span class="str">'error'</span>, <span class="kw">new</span> <span class="fn">Error</span>(<span class="str">'Oups'</span>));
<span class="c">// -> "Erreur gÃ©rÃ©e : Oups" 
// (Le process continue)</span></pre>
                </div>
            </div>

            <div class="demo">
                <div class="demo-title">Event Simulation</div>
                <button class="demo-btn" onclick="demoSubscribe()">1. S'abonner (ON)</button>
                <button class="demo-btn" onclick="demoEmit()">2. Ã‰mettre (EMIT)</button>
                <div id="demo-events-output" class="demo-output">Log des Ã©vÃ©nements...</div>
            </div>
        </div>
    </section>
    <!-- S5: HTTP -->
    <section id="s5">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">05</div>
                <div>
                    <h2 class="sec-title">HTTP (Natif)</h2>
                    <p class="sec-sub">Bas niveau & Anatomie des requÃªtes</p>
                </div>
            </div>

            <div class="intro-box" style="padding:15px; border:1px solid var(--border);">
                <h4>Anatomie d'une Transaction</h4>
                <p>Node hÃ©rite de <code>http.IncomingMessage</code> (Request) et <code>http.ServerResponse</code>
                    (Response).</p>
                <ul style="margin-top:10px; color:var(--muted)">
                    <li><strong>Request</strong> : Readable Stream (Body) + Headers.</li>
                    <li><strong>Response</strong> : Writable Stream.</li>
                </ul>
            </div>

            <div class="grid2">
                <div class="code">
                    <div class="code-head">Serveur Raw (Sans Framework)</div>
                    <pre><span class="kw">import</span> <span class="var">http</span> <span class="kw">from</span> <span class="str">'node:http'</span>;

<span class="var">http</span>.<span class="fn">createServer</span>((<span class="var">req</span>, <span class="var">res</span>) => {
    <span class="c">// 1. Routing manuel (verbe + url)</span>
    <span class="kw">if</span> (<span class="var">req</span>.<span class="var">method</span> === <span class="str">'POST'</span> && <span class="var">req</span>.<span class="var">url</span> === <span class="str">'/echo'</span>) {
        
        <span class="c">// 2. Lire le Body (Stream)</span>
        <span class="kw">let</span> <span class="var">body</span> = [];
        <span class="var">req</span>.<span class="fn">on</span>(<span class="str">'data'</span>, <span class="var">chunk</span> => <span class="var">body</span>.<span class="fn">push</span>(<span class="var">chunk</span>));
        
        <span class="var">req</span>.<span class="fn">on</span>(<span class="str">'end'</span>, () => {
            <span class="var">body</span> = <span class="fn">Buffer</span>.<span class="fn">concat</span>(<span class="var">body</span>).<span class="fn">toString</span>();
            
            <span class="c">// 3. Envoyer RÃ©ponse (Headers + Data)</span>
            <span class="var">res</span>.<span class="fn">writeHead</span>(<span class="num">200</span>, { <span class="str">'Content-Type'</span>: <span class="str">'application/json'</span> });
            <span class="var">res</span>.<span class="fn">end</span>(<span class="fn">JSON</span>.<span class="fn">stringify</span>({ <span class="var">echo</span>: <span class="var">body</span> }));
        });
    } <span class="kw">else</span> {
        <span class="var">res</span>.<span class="fn">statusCode</span> = <span class="num">404</span>;
        <span class="var">res</span>.<span class="fn">end</span>();
    }
}).<span class="fn">listen</span>(<span class="num">3000</span>);</pre>
                </div>

                <div>
                    <h3>HTTPS / SSL</h3>
                    <p>Pour activer HTTPS, il faut charger les certificats (clÃ© privÃ©e et cert public).</p>
                    <pre
                        style="background:var(--bg); border:1px solid var(--border); padding:10px; margin-top:10px; border-radius:5px; font-size:0.8rem;"><span class="kw">import</span> <span class="var">https</span> <span class="kw">from</span> <span class="str">'node:https'</span>;
<span class="kw">import</span> <span class="var">fs</span> <span class="kw">from</span> <span class="str">'node:fs'</span>;

<span class="kw">const</span> <span class="var">options</span> = {
  <span class="var">key</span>: <span class="var">fs</span>.<span class="fn">readFileSync</span>(<span class="str">'key.pem'</span>),
  <span class="var">cert</span>: <span class="var">fs</span>.<span class="fn">readFileSync</span>(<span class="str">'cert.pem'</span>)
};

<span class="var">https</span>.<span class="fn">createServer</span>(<span class="var">options</span>, <span class="var">app</span>).<span class="fn">listen</span>(<span class="num">443</span>);</pre>
                    <p style="margin-top:10px; font-size:0.85rem; color:var(--muted)">En prod, c'est souvent le Reverse
                        Proxy (Nginx) qui gÃ¨re le SSL, pas Node directement.</p>
                </div>
            </div>
        </div>
    </section>
    <!-- S6: EXPRESS -->
    <section id="s6">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">06</div>
                <div>
                    <h2 class="sec-title">Express.js</h2>
                    <p class="sec-sub">Middlewares, Routing & Static Files</p>
                </div>
            </div>

            <details>
                <summary>âš™ï¸ Les Middlewares : La chaÃ®ne de production</summary>
                <div class="details-content">
                    <p>Tout est middleware dans Express. C'est une fonction qui a accÃ¨s Ã  <code>req</code>,
                        <code>res</code>, et <code>next</code>.
                    </p>
                    <p>Si vous n'appelez pas <code>next()</code> ou si vous ne rÃ©pondez pas (<code>res.send</code>), la
                        requÃªte <strong>pend indÃ©finiment</strong>.</p>
                </div>
            </details>

            <div class="grid2">
                <div class="code">
                    <div class="code-head"><span class="dot y"></span>Chain of Responsibility</div>
                    <pre><span class="c">// Middleware 1 : Logger</span>
<span class="var">app</span>.<span class="fn">use</span>((<span class="var">req</span>, <span class="var">res</span>, <span class="var">next</span>) => {
    <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">`Request: ${req.url}`</span>);
    <span class="fn">next</span>(); <span class="c">// â¡ï¸ Passe au suivant</span>
});

<span class="c">// Middleware 2 : Auth Guard</span>
<span class="var">app</span>.<span class="fn">use</span>(<span class="str">'/admin'</span>, (<span class="var">req</span>, <span class="var">res</span>, <span class="var">next</span>) => {
    <span class="kw">if</span> (!<span class="var">req</span>.<span class="var">auth</span>) <span class="kw">return</span> <span class="var">res</span>.<span class="fn">sendStatus</span>(<span class="num">403</span>);
    <span class="fn">next</span>(); <span class="c">// â¡ï¸ Passe au controller</span>
});

<span class="c">// Route Handler (Final Middleware)</span>
<span class="var">app</span>.<span class="fn">get</span>(<span class="str">'/admin'</span>, (<span class="var">req</span>, <span class="var">res</span>) => {
    <span class="var">res</span>.<span class="fn">send</span>(<span class="str">'Welcome Admin'</span>);
});</pre>
                </div>

                <div>
                    <h3>Features Essentielles</h3>

                    <div class="ref-card">
                        <h4>ğŸ“ Fichiers Statiques</h4>
                        <p>Servir CSS, Images, JS du frontend.</p>
                        <pre
                            style="margin-top:5px; background:var(--bg);"><span class="var">app</span>.<span class="fn">use</span>(<span class="var">express</span>.<span class="fn">static</span>(<span class="str">'public'</span>));</pre>
                    </div>

                    <div class="ref-card">
                        <h4>ğŸ”€ Le Router (ModularitÃ©)</h4>
                        <p>Pour ne pas avoir un fichier de 5000 lignes.</p>
                        <pre
                            style="margin-top:5px; background:var(--bg);"><span class="c">// users.js</span>
<span class="kw">const</span> <span class="var">router</span> = <span class="var">express</span>.<span class="fn">Router</span>();
<span class="var">router</span>.<span class="fn">get</span>(<span class="str">'/'</span>, <span class="var">getAll</span>);
<span class="kw">export</span> <span class="kw">default</span> <span class="var">router</span>;

<span class="c">// app.js</span>
<span class="var">app</span>.<span class="fn">use</span>(<span class="str">'/users'</span>, <span class="var">userRouter</span>);</pre>
                    </div>
                </div>
            </div>

            <div class="code" style="margin-top:20px">
                <div class="code-head">Template Engines (Server-Side Rendering)</div>
                <div style="padding:10px; color:var(--muted); font-size:0.9rem;">
                    Bien que Node soit souvent utilisÃ© pour des API JSON (avec React/Vue en front), on peut gÃ©nÃ©rer du
                    HTML
                    avec <strong>EJS</strong>, <strong>Pug</strong> ou <strong>Handlebars</strong>.
                </div>
                <pre><span class="var">app</span>.<span class="fn">set</span>(<span class="str">'view engine'</span>, <span class="str">'ejs'</span>);
<span class="var">app</span>.<span class="fn">get</span>(<span class="str">'/'</span>, (<span class="var">req</span>, <span class="var">res</span>) => {
    <span class="var">res</span>.<span class="fn">render</span>(<span class="str">'index'</span>, { <span class="var">title</span>: <span class="str">'Mon Site'</span> });
});</pre>
            </div>
        </div>
    </section>
    <!-- S7: NPM -->
    <section id="s7">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">07</div>
                <div>
                    <h2 class="sec-title">NPM & Packages</h2>
                    <p class="sec-sub">Gestionnaire de paquets, Scripts & Versioning</p>
                </div>
            </div>

            <div class="grid2">
                <div>
                    <h3>ğŸš€ NPX vs NPM</h3>
                    <ul style="margin-top:10px; color:var(--muted)">
                        <li><strong>NPM</strong> : Installe les paquets (local ou global).</li>
                        <li><strong>NPX</strong> : <em>ExÃ©cute</em> un binaire sans l'installer globalement (ex:
                            <code>npx create-react-app</code>).
                        </li>
                    </ul>
                </div>

                <div class="ref-card">
                    <h4>Semantic Versioning (SemVer)</h4>
                    <p style="font-family:monospace; font-size:1.1rem; color:var(--primary-bright)">MAJOR.MINOR.PATCH
                    </p>
                    <ul style="font-size:0.85rem; margin-top:5px; color:var(--muted)">
                        <li><strong>^</strong>1.2.3 : Update Minor & Patch (Safe)</li>
                        <li><strong>~</strong>1.2.3 : Update Patch only (Very Safe)</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin-top:25px;">Scripts & Lifecycle</h3>
            <div class="code">
                <div class="code-head">package.json</div>
                <pre><span class="str">"scripts"</span>: {
  <span class="str">"start"</span>: <span class="str">"node index.js"</span>,
  <span class="str">"dev"</span>: <span class="str">"nodemon index.js"</span>,
  <span class="str">"test"</span>: <span class="str">"jest"</span>,
  <span class="str">"build"</span>: <span class="str">"tsc"</span>,
  <span class="str">"prebuild"</span>: <span class="str">"rimraf dist"</span> <span class="c">// S'exÃ©cute AVANT build</span>
}</pre>
            </div>

            <div class="tip">
                <strong>ğŸ”’ Package-lock.json</strong><br>
                Ce fichier est CRUCIAL. Il verrouille l'arbre exact des dÃ©pendances. DOIT Ãªtre commitÃ©.
                Il garantit que "Ã§a marche chez moi" = "Ã§a marche en prod".
            </div>

            <div class="grid2">
                <div class="code">
                    <div class="code-head">Commandes AvancÃ©es</div>
                    <pre><span class="c"># Auditer les vulnÃ©rabilitÃ©s</span>
npm audit

<span class="c"># Mettre Ã  jour les paquets (selon package.json)</span>
npm update

<span class="c"># Installer version prÃ©cise</span>
npm i express@4.17.1

<span class="c"># Prune (supprimer packages inutiles)</span>
npm prune</pre>
                </div>

                <div class="ref-card">
                    <h4>Alternatives</h4>
                    <p><strong>Yarn</strong> ou <strong>PNPM</strong> (plus rapide, gestion disque optimisÃ©e) sont trÃ¨s
                        populaires en entreprise.</p>
                </div>
            </div>
        </div>
    </section>
    <!-- S8: ENV -->
    <section id="s8">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">08</div>
                <div>
                    <h2 class="sec-title">Configurations</h2>
                    <p class="sec-sub">Variables d'Environnement (12-Factor App)</p>
                </div>
            </div>

            <div class="warning">
                <strong>âš ï¸ SÃ©curitÃ© & Git</strong><br>
                Ajoutez TOUJOURS <code>.env</code> Ã  votre <code>.gitignore</code>.<br>
                Commitez un fichier <code>.env.example</code> avec les clÃ©s vides pour l'Ã©quipe.
            </div>

            <div class="grid2">
                <div class="code">
                    <div class="code-head">Utilisation Standard</div>
                    <pre><span class="c">// npm i dotenv</span>
<span class="kw">import</span> <span class="str">'dotenv/config'</span>;

<span class="kw">const</span> <span class="var">PORT</span> = <span class="var">process</span>.<span class="var">env</span>.<span class="var">PORT</span> || <span class="num">3000</span>;
<span class="kw">const</span> <span class="var">DB_URL</span> = <span class="var">process</span>.<span class="var">env</span>.<span class="var">DB_URL</span>;

<span class="kw">if</span> (!<span class="var">DB_URL</span>) {
    <span class="kw">throw</span> <span class="kw">new</span> <span class="fn">Error</span>(<span class="str">"DB_URL manquante !"</span>);
}</pre>
                </div>

                <div class="ref-card">
                    <h4>Typage & Validation</h4>
                    <p>En production, il est vital de valider les variables au dÃ©marrage. Utilisez <strong>Zod</strong>,
                        <strong>Joi</strong> ou <strong>Envalid</strong>.
                    </p>
                    <pre
                        style="margin-top:10px; font-size:0.8rem; background:var(--bg); border-radius:4px; padding:8px;"><span class="kw">import</span> { <span class="var">z</span> } <span class="kw">from</span> <span class="str">'zod'</span>;

<span class="kw">const</span> <span class="var">envSchema</span> = <span class="var">z</span>.<span class="fn">object</span>({
  <span class="var">PORT</span>: <span class="var">z</span>.<span class="fn">coerce</span>.<span class="fn">number</span>(),
  <span class="var">API_KEY</span>: <span class="var">z</span>.<span class="fn">string</span>().<span class="fn">min</span>(<span class="num">10</span>)
});

<span class="kw">export</span> <span class="kw">const</span> <span class="var">env</span> = <span class="var">envSchema</span>.<span class="fn">parse</span>(<span class="var">process</span>.<span class="var">env</span>);</pre>
                </div>
            </div>

            <h3 style="margin-top:30px;">Cross-Env</h3>
            <p style="color:var(--muted); margin-bottom:10px;">Windows et Linux/Mac gÃ¨rent les variables diffÃ©remment
                dans
                le terminal.</p>
            <div class="code">
                <div class="code-head">Solution (package.json)</div>
                <pre><span class="c">// Sans cross-env (Bug sur Windows)</span>
<span class="str">"start"</span>: <span class="str">"NODE_ENV=production node app.js"</span>

<span class="c">// Avec cross-env (Universel)</span>
<span class="str">"start"</span>: <span class="str">"cross-env NODE_ENV=production node app.js"</span></pre>
            </div>
        </div>
    </section>
    <!-- S9: STREAMS -->
    <section id="s9">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">09</div>
                <div>
                    <h2 class="sec-title">Streams</h2>
                    <p class="sec-sub">Flux de donnÃ©es, Backpressure & Pipeline</p>
                </div>
            </div>

            <div class="grid2">
                <div>
                    <h3>Les 4 Types de Streams</h3>
                    <ul style="margin-top:10px; line-height:1.7; color:var(--muted)">
                        <li><strong style="color:var(--primary-bright)">Readable</strong> : Source (fs.read, req). On
                            lit.
                        </li>
                        <li><strong style="color:var(--primary-bright)">Writable</strong> : Destination (fs.write, res).
                            On
                            Ã©crit.</li>
                        <li><strong style="color:var(--primary-bright)">Duplex</strong> : Les deux (Socket TCP).</li>
                        <li><strong style="color:var(--primary-bright)">Transform</strong> : Modifie les donnÃ©es Ã  la
                            volÃ©e
                            (Gzip, Crypto).</li>
                    </ul>
                </div>

                <div class="intro-box" style="padding:15px; margin:0; border:1px solid var(--border);">
                    <h4>ğŸŒŠ Backpressure</h4>
                    <p>Si le disque Ã©crit moins vite que le rÃ©seau ne lit, la mÃ©moire explose. </p>
                    <p>Le <strong>Pipe</strong> gÃ¨re automatiquement la "Backpressure" : il dit Ã  la source de pauser
                        (pause/resume) le temps que la destination rattrape.</p>
                </div>
            </div>

            <h3 style="margin-top:30px;">Modern Streams (Pipeline)</h3>
            <div class="code">
                <div class="code-head"><span class="dot r"></span>Pipeline Async (Best Practice)</div>
                <pre><span class="kw">import</span> { <span class="fn">pipeline</span> } <span class="kw">from</span> <span class="str">'node:stream/promises'</span>;
<span class="kw">import</span> <span class="var">fs</span> <span class="kw">from</span> <span class="str">'node:fs'</span>;
<span class="kw">import</span> <span class="var">zlib</span> <span class="kw">from</span> <span class="str">'node:zlib'</span>;

<span class="kw">async</span> <span class="kw">function</span> <span class="fn">archiveLog</span>() {
    <span class="kw">await</span> <span class="fn">pipeline</span>(
        <span class="var">fs</span>.<span class="fn">createReadStream</span>(<span class="str">'app.log'</span>),     <span class="c">// 1. Lire</span>
        <span class="var">zlib</span>.<span class="fn">createGzip</span>(),                  <span class="c">// 2. Compresser</span>
        <span class="var">fs</span>.<span class="fn">createWriteStream</span>(<span class="str">'app.log.gz'</span>)  <span class="c">// 3. Ã‰crire</span>
    );
    <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">'SuccÃ¨s !'</span>);
    <span class="c">// Pipeline gÃ¨re aussi la fermeture auto des streams et les erreurs !</span>
}</pre>
            </div>

            <div class="details-content"
                style="margin-top:15px; background:var(--bg2); border-radius:8px; padding:15px;">
                <h4 style="color:var(--accent)">Generators & Streams</h4>
                <p>On peut transformer un Stream en async iterator.</p>
                <div class="code" style="margin-top:10px; margin-bottom:0;">
                    <pre><span class="kw">for</span> <span class="kw">await</span> (<span class="kw">const</span> <span class="var">chunk</span> <span class="kw">of</span> <span class="var">stream</span>) {
    <span class="fn">process</span>(<span class="var">chunk</span>);
}</pre>
                </div>
            </div>
        </div>
    </section>
    <!-- S10: ERROR HANDLING -->
    <section id="s10">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">10</div>
                <div>
                    <h2 class="sec-title">Gestion d'Erreurs</h2>
                    <p class="sec-sub">Robustesse, Custom Errors & Crash Prevention</p>
                </div>
            </div>

            <div class="grid2">
                <div class="code">
                    <div class="code-head">Custom Error Class</div>
                    <pre><span class="kw">class</span> <span class="fn">ApiError</span> <span class="kw">extends</span> <span class="fn">Error</span> {
  <span class="fn">constructor</span>(<span class="var">message</span>, <span class="var">statusCode</span>) {
    <span class="kw">super</span>(<span class="var">message</span>);
    <span class="kw">this</span>.<span class="var">statusCode</span> = <span class="var">statusCode</span>;
    <span class="kw">this</span>.<span class="var">isOperational</span> = <span class="kw">true</span>;
    <span class="fn">Error</span>.<span class="fn">captureStackTrace</span>(<span class="kw">this</span>, <span class="kw">this</span>.<span class="fn">constructor</span>);
  }
}

<span class="kw">throw</span> <span class="kw">new</span> <span class="fn">ApiError</span>(<span class="str">"Produit non trouvÃ©"</span>, <span class="num">404</span>);</pre>
                </div>

                <div class="warning">
                    <strong>ğŸš¨ Erreurs Fatales</strong><br>
                    Certaines erreurs ne peuvent pas Ãªtre capturÃ©es par un `try/catch` (ex: syntaxe, manque de mÃ©moire).
                    Pour le reste, utilisez :
                    <ul style="margin-top:5px; font-size:0.85rem">
                        <li><code>process.on('uncaughtException')</code></li>
                        <li><code>process.on('unhandledRejection')</code></li>
                    </ul>
                </div>
            </div>

            <h3 style="margin-top:30px;">Best Practices : Async/Await</h3>
            <div class="code">
                <div class="code-head"><span class="dot r"></span>Le pattern "Catch-All" Express</div>
                <pre><span class="c">// Un wrapper pour Ã©viter les try/catch rÃ©pÃ©titifs</span>
<span class="kw">const</span> <span class="fn">catchAsync</span> = <span class="var">fn</span> => (<span class="var">req</span>, <span class="var">res</span>, <span class="var">next</span>) => {
    <span class="var">fn</span>(<span class="var">req</span>, <span class="var">res</span>, <span class="var">next</span>).<span class="fn">catch</span>(<span class="var">next</span>);
};

<span class="var">app</span>.<span class="fn">get</span>(<span class="str">'/data'</span>, <span class="fn">catchAsync</span>(<span class="kw">async</span> (<span class="var">req</span>, <span class="var">res</span>) => {
    <span class="kw">const</span> <span class="var">result</span> = <span class="kw">await</span> <span class="fn">heavyTask</span>();
    <span class="var">res</span>.<span class="fn">json</span>(<span class="var">result</span>);
}));</pre>
            </div>

            <div class="tip">
                <strong>ğŸ’¡ Operational vs Programmer Errors</strong><br>
                - <strong>Operational</strong> : On s'y attend (ex: timeout, 404). On doit les gÃ©rer proprement.<br>
                - <strong>Programmer</strong> : Bugs (ex: undefined is not a function). Solution : <strong>CRASH &
                    RESTART</strong> (via PM2). Ne jamais essayer de continuer une app corrompue.
            </div>
        </div>
    </section>
    <!-- S11: PROCESS OS -->
    <section id="s11">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">11</div>
                <div>
                    <h2 class="sec-title">Process & OS</h2>
                    <p class="sec-sub">Gestion du systÃ¨me & Multi-processus</p>
                </div>
            </div>

            <div class="grid2">
                <div class="code">
                    <div class="code-head">Child Processes (L'art de dÃ©lÃ©guer)</div>
                    <pre><span class="kw">import</span> { <span class="fn">spawn</span>, <span class="fn">exec</span> } <span class="kw">from</span> <span class="str">'node:child_process'</span>;

<span class="c">// exec : Petit script (Bufferise tout la sortie)</span>
<span class="fn">exec</span>(<span class="str">'ls -lh'</span>, (<span class="var">err</span>, <span class="var">stdout</span>) => {
    <span class="fn">console</span>.<span class="fn">log</span>(<span class="var">stdout</span>);
});

<span class="c">// spawn : Flux de donnÃ©es (Longues tÃ¢ches)</span>
<span class="kw">const</span> <span class="var">ls</span> = <span class="fn">spawn</span>(<span class="str">'find'</span>, [<span class="str">'/'</span>]);
<span class="var">ls</span>.<span class="var">stdout</span>.<span class="fn">on</span>(<span class="str">'data'</span>, <span class="var">data</span> => <span class="fn">console</span>.<span class="fn">log</span>(<span class="var">data</span>));</pre>
                </div>

                <div class="ref-card">
                    <h4>Arguments & CWD</h4>
                    <p style="font-size:0.85rem; color:var(--muted)">AccÃ©der aux arguments passÃ©s en console :</p>
                    <code style="color:var(--primary-bright)">process.argv[2]</code>
                    <p style="margin-top:10px; font-size:0.85rem; color:var(--muted)">Dossier actuel :</p>
                    <code style="color:var(--primary-bright)">process.cwd()</code>
                </div>
            </div>

            <h3 style="margin-top:30px;">Graceful Shutdown (Standard de Production)</h3>
            <p style="color:var(--muted); margin-bottom:10px;">Indispensable en Docker pour ne pas couper les requÃªtes
                HTTP
                en cours lors d'un dÃ©ploiement.</p>
            <div class="code">
                <div class="code-head"><span class="dot y"></span>SIGINT / SIGTERM</div>
                <pre><span class="var">process</span>.<span class="fn">on</span>(<span class="str">'SIGTERM'</span>, () => {
  <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">'Ressu SIGTERM. Fermeture propre...'</span>);
  <span class="var">server</span>.<span class="fn">close</span>(() => {
    <span class="fn">console</span>.<span class="fn">log</span>(<span class="str">'Serveur fermÃ©. Fin du process.'</span>);
    <span class="var">db</span>.<span class="fn">disconnect</span>();
    <span class="var">process</span>.<span class="fn">exit</span>(<span class="num">0</span>);
  });
});</pre>
            </div>

            <div class="grid2">
                <div class="ref-card">
                    <h4>os module</h4>
                    <ul style="font-size:0.85rem; line-height:1.6; color:var(--muted)">
                        <li><code>os.uptime()</code> : Temps de marche</li>
                        <li><code>os.loadavg()</code> : Charge CPU</li>
                        <li><code>os.networkInterfaces()</code> : IPs locales</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
    <!-- S99: QUIZ -->
    <section id="quiz-section">
        <div class="container">
            <div class="sec-header">
                <div class="sec-num">99</div>
                <div>
                    <h2 class="sec-title">Quiz Expert</h2>
                    <p class="sec-sub">Testez vos connaissances sur Node.js</p>
                </div>
            </div>

            <div class="quiz-container">
                <div id="quiz-app">
                    <!-- Le moteur de quiz injectera le contenu ici -->
                    <div class="loader">Chargement du quiz...</div>
                </div>
            </div>

            <div class="ref-card" style="margin-top:40px; border-style:dashed;">
                <h4>ğŸ“ Conseils pour l'examen</h4>
                <p style="font-size:0.9rem; color:var(--muted)">
                    Ce quiz couvre des notions allant du dÃ©butant Ã  l'expert. Si vous obtenez plus de 80%, vous
                    maÃ®trisez
                    les concepts fondamentaux de l'architecture Node.js.
                </p>
                <button class="demo-btn" style="margin-top:10px" onclick="resetQuiz()">Recommencer le Quiz</button>
            </div>
        </div>
    </section>


    <footer>
        <div class="container">
            <p><strong>MÃ©mo Node.js</strong> â€¢ 2025 Edition</p>
            <p style="font-size:0.9rem; margin-top:12px; line-height:1.6; opacity:0.8;">
                CrÃ©Ã© par Geoffroy Streit, assistÃ© par IA â€” Pour consolider sa mÃ©moire avec un cours concis, graphique et
                structurÃ©, mais
                aussi pour le plaisir de partager la connaissance et faciliter l'apprentissage des autres.
            </p>
        </div>
    </footer>

    <script src="../../assets/js/quiz-engine.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialisation du Quiz si l'Ã©lÃ©ment existe
            if (window.QuizEngine && document.getElementById('quiz-app')) {
                new window.QuizEngine({
                    containerId: 'quiz-app',
                    jsonPath: 'quiz_node.json',
                    questionsPerSession: 10
                });
            }
        });
    </script>

    <script src="script.js"></script>
</body>

</html>