<div class="sec-header">
    <div class="sec-num">03</div>
    <div>
        <h2 class="sec-title">Structures de Contr√¥le</h2>
        <p class="sec-sub">Logique d√©cisionnelle et It√©rations : Le cerveau de vos scripts</p>
    </div>
</div>

<div class="intro-box">
    <p>Sans structures de contr√¥le, un programme ne serait qu'une liste de courses ex√©cut√©e de haut en bas.
        Ce sont elles qui permettent de prendre des <strong>d√©cisions</strong> (Conditions) et de <strong>r√©p√©ter des
            t√¢ches</strong> (Boucles).</p>
</div>

<!-- PARTIE 1 : STRUCTURES CONDITIONNELLES -->
<section>
    <h3>1. Prendre des d√©cisions (Conditions)</h3>
    <div class="grid2">
        <div class="ref-card">
            <h4>üö¶ Analogie : L'Aiguillage</h4>
            <p>Imaginez un train arrivant √† une bifurcation. L'aiguillage (la condition) d√©cide si le train va vers la
                voie A, B ou C en fonction d'un signal (Vrai ou Faux).</p>
        </div>
        <div class="ref-card">
            <pre style="background:transparent; border:none; padding:0; font-size:0.7rem;">
   [D√©but]
      |
   < Si ? > --FAUX--> [Voie B]
      |               (else)
    VRAI
      |
   [Voie A]
   (if)</pre>
        </div>
    </div>

    <h4>Syntaxe Classique & Alternative</h4>
    <p>PHP propose deux syntaxes. La syntaxe alternative est <strong>indispensable</strong> quand on m√©lange PHP et
        HTML.</p>

    <div class="grid2">
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Standard (Accolades)</div>
            <pre><span class="kw">if</span> (<span class="var">$score</span> >= <span class="num">10</span>) {
    <span class="kw">echo</span> <span class="str">"Bravo !"</span>;
} <span class="kw">elseif</span> (<span class="var">$score</span> > <span class="num">5</span>) {
    <span class="kw">echo</span> <span class="str">"Pas mal"</span>;
} <span class="kw">else</span> {
    <span class="kw">echo</span> <span class="str">"R√©vise encore"</span>;
}</pre>
        </div>
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Template (Alternative)</div>
            <pre><span class="tag">&lt;?php</span> <span class="kw">if</span> (<span class="var">$user</span>-&gt;<span class="prop">isAdmin</span>): <span class="tag">?&gt;</span>
    &lt;button&gt;Supprimer&lt;/button&gt;
<span class="tag">&lt;?php</span> <span class="kw">elseif</span> (<span class="var">$user</span>-&gt;<span class="prop">isEditor</span>): <span class="tag">?&gt;</span>
    &lt;button&gt;√âditer&lt;/button&gt;
<span class="tag">&lt;?php</span> <span class="kw">else</span>: <span class="tag">?&gt;</span>
    &lt;p&gt;Lecture seule&lt;/p&gt;
<span class="tag">&lt;?php</span> <span class="kw">endif</span>; <span class="tag">?&gt;</span></pre>
        </div>
    </div>

    <div class="grid2" style="margin-top:20px;">
        <div class="ref-card">
            <h4>‚úÖ Bonnes pratiques</h4>
            <ul>
                <li>Privil√©gier <code>===</code> et <code>!==</code> pour √©viter la coercition.</li>
                <li>Pr√©f√©rer des conditions courtes et nomm√©es (variables explicites).</li>
                <li>Utiliser des retours anticip√©s pour r√©duire l'imbrication.</li>
                <li>Limiter les <code>else</code> profonds pour garder la lisibilit√©.</li>
            </ul>
        </div>
        <div class="ref-card">
            <h4>‚ö†Ô∏è Pi√®ges classiques</h4>
            <ul>
                <li><code>0</code>, <code>'0'</code>, <code>[]</code>, <code>null</code> sont falsy.</li>
                <li><code>empty()</code> masque parfois une erreur de variable non d√©finie.</li>
                <li>Les comparaisons l√¢ches peuvent surprendre.</li>
            </ul>
            <button class="example-toggle">Voir un cas r√©el</button>
            <div class="example-content">
<pre><span class="var">$qty</span> = <span class="str">'0'</span>;
<span class="kw">if</span> (<span class="var">$qty</span>) {
    <span class="kw">echo</span> <span class="str">'Stock pr√©sent'</span>;
} <span class="kw">else</span> {
    <span class="kw">echo</span> <span class="str">'Rupture'</span>;
}</pre>
            </div>
        </div>
    </div>

    <div class="grid2" style="margin-top:20px;">
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Switch (Alternative √† match)</div>
            <pre><span class="kw">switch</span> (<span class="var">$ext</span>) {
    <span class="kw">case</span> <span class="str">'png'</span>:
    <span class="kw">case</span> <span class="str">'jpg'</span>:
        <span class="var">$type</span> = <span class="str">'image'</span>;
        <span class="kw">break</span>;
    <span class="kw">case</span> <span class="str">'mp4'</span>:
        <span class="var">$type</span> = <span class="str">'video'</span>;
        <span class="kw">break</span>;
    <span class="kw">default</span>:
        <span class="var">$type</span> = <span class="str">'inconnu'</span>;
}</pre>
        </div>
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Match (PHP 8+)</div>
            <pre><span class="var">$type</span> = <span class="kw">match</span>(<span class="var">$ext</span>) {
    <span class="str">'png'</span>, <span class="str">'jpg'</span> => <span class="str">'image'</span>,
    <span class="str">'mp4'</span> => <span class="str">'video'</span>,
    <span class="kw">default</span> => <span class="str">'inconnu'</span>,
};</pre>
        </div>
    </div>

    <div class="ref-card" style="margin-top:20px;">
        <h4>üéØ Switch vs Match</h4>
        <ul>
            <li><code>match</code> renvoie une valeur et compare strictement.</li>
            <li><code>switch</code> est plus verbeux mais tol√®re le fall-through.</li>
            <li><code>match</code> √©vite les <code>break</code> oubli√©s.</li>
        </ul>
        <button class="example-toggle">Voir une mise en situation</button>
        <div class="example-content">
<pre><span class="var">$status</span> = <span class="str">'paid'</span>;
<span class="var">$label</span> = <span class="kw">match</span>(<span class="var">$status</span>) {
    <span class="str">'paid'</span> => <span class="str">'Pay√©'</span>,
    <span class="str">'pending'</span> => <span class="str">'En attente'</span>,
    <span class="kw">default</span> => <span class="str">'Inconnu'</span>,
};
<span class="kw">echo</span> <span class="var">$label</span>;</pre>
        </div>
    </div>

    <div class="grid2" style="margin-top:20px;">
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Ternaire</div>
            <pre><span class="var">$res</span> = <span class="var">$isVip</span> ? <span class="str">'Acc√®s rapide'</span> : <span class="str">'Acc√®s standard'</span>;</pre>
        </div>
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Coalescing</div>
            <pre><span class="var">$user</span> = <span class="var">$_GET</span>[<span class="str">'u'</span>] ?? <span class="str">'Anonyme'</span>;</pre>
        </div>
    </div>

    <div class="info" style="margin-top:20px;">
        <strong>Cas d'usage fr√©quents</strong><br>
        Authentification, validation de formulaires, routing, filtres de recherche, gestion des r√¥les.
    </div>
</section>

<hr style="border:0; border-top:1px solid var(--border); margin:40px 0;">

<!-- PARTIE 2 : STRUCTURES IT√âRATIVES -->
<section>
    <h3>2. R√©p√©ter des t√¢ches (Boucles)</h3>

    <div class="grid2">
        <div class="ref-card">
            <h4>üîÑ Analogie : La Roue</h4>
            <p>Une boucle est une roue qui tourne tant qu'une condition (le carburant) est pr√©sente. D√®s qu'il n'y a
                plus de carburant, la roue s'arr√™te.</p>
        </div>
        <div class="ref-card">
            <pre style="background:transparent; border:none; padding:0; font-size:0.7rem;">
  ---[Action] ---
 |               |
  ---< Encore ? >--NON--> [Sortie]
         |
        OUI</pre>
        </div>
    </div>

    <div class="grid2">
        <!-- FOR -->
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span class="dot g"></span>For
                (Compteur)</div>
            <pre><span class="c">// Initialisation ; Condition ; Incr√©mentation</span>
<span class="kw">for</span> (<span class="var">$i</span> = <span class="num">0</span>; <span class="var">$i</span> < <span class="num">5</span>; <span class="var">$i</span>++) {
    <span class="kw">echo</span> <span class="str">"Tour n¬∞"</span> . <span class="var">$i</span>;
}</pre>
        </div>
        <!-- FOREACH -->
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Foreach (Tableaux)</div>
            <pre><span class="c">// Version simple</span>
<span class="kw">foreach</span> (<span class="var">$items</span> <span class="kw">as</span> <span class="var">$item</span>) { ... }

<span class="c">// Version avec cl√© (Dictionnaire)</span>
<span class="kw">foreach</span> (<span class="var">$user</span> <span class="kw">as</span> <span class="var">$key</span> => <span class="var">$val</span>) {
    <span class="kw">echo</span> <span class="str">"$key : $val"</span>;
}</pre>
        </div>
    </div>

    <div class="grid2" style="margin-top:20px;">
        <!-- WHILE -->
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>While (Tant que...)</div>
            <pre><span class="c">// Tant que la condition est VRAIE</span>
<span class="kw">while</span> (<span class="var">$line</span> = <span class="fn">fgets</span>(<span class="var">$file</span>)) {
    <span class="kw">echo</span> <span class="var">$line</span>;
}</pre>
        </div>
        <!-- DO WHILE -->
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span class="dot g"></span>Do
                While (Au moins une fois)</div>
            <pre><span class="c">// Ex√©cute d'abord, v√©rifie ensuite</span>
<span class="kw">do</span> {
    <span class="var">$code</span> = <span class="fn">generateCode</span>();
} <span class="kw">while</span> (<span class="fn">existsInDb</span>(<span class="var">$code</span>));</pre>
        </div>
    </div>

    <div class="grid2" style="margin-top:20px;">
        <div class="ref-card">
            <h4>üß≠ Choisir la bonne boucle</h4>
            <table>
                <tr>
                    <th>Situation</th>
                    <th>Boucle conseill√©e</th>
                </tr>
                <tr>
                    <td>Compteur pr√©cis</td>
                    <td><code>for</code></td>
                </tr>
                <tr>
                    <td>Liste ou tableau</td>
                    <td><code>foreach</code></td>
                </tr>
                <tr>
                    <td>Flux inconnu</td>
                    <td><code>while</code></td>
                </tr>
                <tr>
                    <td>Ex√©cuter au moins une fois</td>
                    <td><code>do...while</code></td>
                </tr>
            </table>
        </div>
        <div class="ref-card">
            <h4>üö® Contr√¥le fin</h4>
            <button class="example-toggle">Voir break / continue</button>
            <div class="example-content">
<pre><span class="kw">foreach</span> (<span class="var">$orders</span> <span class="kw">as</span> <span class="var">$order</span>) {
    <span class="kw">if</span> (!<span class="var">$order</span>[<span class="str">'paid'</span>]) {
        <span class="kw">continue</span>;
    }
    <span class="kw">if</span> (<span class="var">$order</span>[<span class="str">'total'</span>] > <span class="num">1000</span>) {
        <span class="kw">break</span>;
    }
    <span class="kw">echo</span> <span class="var">$order</span>[<span class="str">'id'</span>];
}</pre>
            </div>
        </div>
    </div>

    <div class="tip" style="margin-top:20px;">
        <strong>üí° Astuce de performance</strong><br>
        Pr√©f√©rer <code>foreach</code> sur les tableaux et √©viter les recalculs dans la condition d'une boucle.
    </div>
</section>

<!-- PARTIE 3 : LE CONSEIL DU PRO (YIELD) -->
<section>
    <h3>3. Le mot-cl√© "yield" : Les G√©n√©rateurs</h3>

    <div class="info">
        <p><strong>Question :</strong> Que fait <code>yield</code> ?</p>
        <p><strong>R√©ponse courte :</strong> Il transforme une fonction en "distributeur" de donn√©es qui s'arr√™te et
            reprend.
            C'est le secret pour traiter 1 million de lignes avec seulement 2 Mo de RAM.</p>
    </div>

    <div class="grid2">
        <div class="ref-card">
            <h4>üç¨ Analogie : Le Distributeur de PEZ</h4>
            <p>Imaginez un sac de 1000 bonbons (Array). Pour le transporter, il vous faut un grand sac lourd (RAM).</p>
            <p>Le <code>yield</code> est un <strong>distributeur de PEZ</strong>. Il ne contient qu'un bonbon √† la fois.
                Vous demandez le suivant, il le sort, puis s'arr√™te. Pas besoin de gros sac !</p>
        </div>
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span class="dot g"></span>Un
                G√©n√©rateur simple</div>
            <pre><span class="kw">function</span> <span class="fn">compteur_infini</span>() {
    <span class="var">$i</span> = <span class="num">0</span>;
    <span class="kw">while</span>(<span class="kw">true</span>) {
        <span class="kw">yield</span> <span class="var">$i</span>++; <span class="c">// Met la fonction en PAUSE ici</span>
    }
}

<span class="kw">foreach</span> (<span class="fn">compteur_infini</span>() <span class="kw">as</span> <span class="var">$nb</span>) {
    <span class="kw">echo</span> <span class="var">$nb</span>;
    <span class="kw">if</span> (<span class="var">$nb</span> > <span class="num">1000</span>) <span class="kw">break</span>;
}</pre>
        </div>
    </div>

    <div class="tip">
        <strong>üí° Quand utiliser yield ?</strong><br>
        D√®s que vous lisez un fichier CSV de + de 50 Mo ou que vous bouclez sur des milliers de r√©sultats SQL.
    </div>
</section>

<!-- INTERACTIVIT√â SIMUL√âE -->
<div class="demo">
    <div class="demo-title">üõ†Ô∏è Mise en situation</div>
    <p style="font-size:0.85rem;">Vous devez afficher une liste d'articles seulement si elle n'est pas vide.</p>
    <div class="code">
        <pre><span class="tag">&lt;?php</span> <span class="kw">if</span> (<span class="var">$articles</span>): <span class="tag">?&gt;</span>
    &lt;ul&gt;
    <span class="tag">&lt;?php</span> <span class="kw">foreach</span>(<span class="var">$articles</span> <span class="kw">as</span> <span class="var">$a</span>): <span class="tag">?&gt;</span>
        &lt;li&gt;&lt;?= <span class="var">$a</span>['titre'] ?&gt;&lt;/li&gt;
    <span class="tag">&lt;?php</span> <span class="kw">endforeach</span>; <span class="tag">?&gt;</span>
    &lt;/ul&gt;
<span class="tag">&lt;?php</span> <span class="kw">else</span>: <span class="tag">?&gt;</span>
    &lt;p&gt;Aucun article trouv√©.&lt;/p&gt;
<span class="tag">&lt;?php</span> <span class="kw">endif</span>; <span class="tag">?&gt;</span></pre>
    </div>
</div>

<div class="demo" style="margin-top:20px;">
    <div class="demo-title">üéÆ Mini-simulation</div>
    <p style="font-size:0.85rem;">Un utilisateur tente d'acc√©der √† une page d'administration.</p>
    <button class="example-toggle">Voir la solution</button>
    <div class="example-content">
<pre><span class="var">$role</span> = <span class="str">'editor'</span>;
<span class="kw">if</span> (<span class="var">$role</span> === <span class="str">'admin'</span>) {
    <span class="kw">echo</span> <span class="str">'Acc√®s total'</span>;
} <span class="kw">elseif</span> (<span class="var">$role</span> === <span class="str">'editor'</span>) {
    <span class="kw">echo</span> <span class="str">'Acc√®s limit√©'</span>;
} <span class="kw">else</span> {
    <span class="kw">echo</span> <span class="str">'Acc√®s refus√©'</span>;
}</pre>
    </div>
</div>
