<div class="sec-header">
    <div class="sec-num">05</div>
    <div>
        <h2 class="sec-title">Cha√Ænes de caract√®res (Strings)</h2>
        <p class="sec-sub">Au-del√† du texte : Manipulation, S√©curit√© et Encodage</p>
    </div>
</div>

<div class="intro-box">
    <p>Une cha√Æne de caract√®res est une s√©quence d'octets. En PHP, elles sont partout : du contenu HTML aux requ√™tes SQL
        en passant par le JSON. Savoir les manipuler sans faille est la base du m√©tier.</p>
</div>

<div class="info">
    <strong>üéØ Objectif du module</strong><br>
    Passer d'une simple manipulation de texte √† un vrai <strong>pipeline ma√Ætris√©</strong> : formater, transformer,
    s√©curiser, livrer.
</div>

<div class="grid2" style="margin-top:10px;">
    <div class="ref-card">
        <h4>üß† Cycle d'une string</h4>
        <ul>
            <li>Entr√©e brute ‚Üí Validation</li>
            <li>Normalisation ‚Üí Transformation</li>
            <li>√âchappement ‚Üí Affichage</li>
        </ul>
    </div>
    <div class="ref-card">
        <pre style="background:transparent; border:none; padding:0; font-size:0.7rem;">
[ Entr√©e ]
   |
[ Validation ]
   |
[ Normalisation ]
   |
[ Transformation ]
   |
[ √âchappement ]
   |
[ Sortie ]</pre>
    </div>
</div>

<details>
    <summary>üìñ Pourquoi c'est critique ?</summary>
    <div>
        <p>Une string mal trait√©e peut casser un JSON, ouvrir une faille XSS, faire tomber un export CSV ou fausser une
            recherche. C'est l'endroit o√π se jouent la fiabilit√© et la s√©curit√©.</p>
    </div>
</details>

<section>
    <h3>1. L'Art de la Citation</h3>
    <div class="grid2">
        <div class="ref-card">
            <h4>üß∂ Analogie : Le Fil d'Ariane</h4>
            <p>Une string est un fil sur lequel on enfile des perles (les caract√®res). On peut couper le fil,
                l'allonger, ou changer une perle √† un endroit pr√©cis.</p>
        </div>
        <div class="ref-card">
            <h4>‚ùì Simple ou Double ?</h4>
            <p><strong>'Cote simple'</strong> : PHP ne regarde pas dedans. C'est du texte brut (plus rapide).</p>
            <p><strong>"Cote double"</strong> : PHP analyse le contenu pour y injecter des variables (Interpolation).
            </p>
        </div>
    </div>

    <div class="code">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>Syntaxe.php</div>
        <pre><span class="var">$nom</span> = <span class="str">"Geoff"</span>;

<span class="c">// Interpolation classique</span>
<span class="kw">echo</span> <span class="str">"Salut $nom"</span>;

<span class="c">// Syntaxe complexe (Recommand√©e pour la clart√©)</span>
<span class="kw">echo</span> <span class="str">"L'utilisateur {$nom} a gagn√©."</span>;

<span class="c">// Heredoc (Multi-ligne avec interpolation)</span>
<span class="var">$html</span> = <span class="str">&lt;&lt;&lt;HTML
&lt;div class="user"&gt;
    &lt;h2&gt;$nom&lt;/h2&gt;
&lt;/div&gt;
HTML</span>;</pre>
    </div>

    <div class="grid2" style="margin-top:10px;">
        <div class="ref-card">
            <h4>üîÄ Alternatives d'assemblage</h4>
            <ul>
                <li>Concat√©nation avec <code>.</code></li>
                <li>Interpolation avec <code>"$var"</code></li>
                <li>Formatage avec <code>sprintf</code></li>
            </ul>
        </div>
        <div class="ref-card">
            <h4>üßæ Nowdoc</h4>
            <p>Alternative au heredoc quand vous voulez du texte brut, sans interpolation.</p>
        </div>
    </div>

    <div class="code" style="margin-top:10px;">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>Assemblage.php</div>
        <pre><span class="var">$prenom</span> = <span class="str">"Lina"</span>;
<span class="var">$ville</span> = <span class="str">"Paris"</span>;

<span class="var">$a</span> = <span class="str">"Bonjour "</span> . <span class="var">$prenom</span>;
<span class="var">$b</span> = <span class="str">"Bonjour $prenom"</span>;
<span class="var">$c</span> = <span class="fn">sprintf</span>(<span class="str">"%s vient de %s"</span>, <span class="var">$prenom</span>, <span class="var">$ville</span>);

<span class="var">$txt</span> = <span class="str">&lt;&lt;&lt;'TXT'
Ce bloc n'interpole pas les variables : $prenom
TXT</span>;</pre>
    </div>

    <div class="ref-card" style="margin-top:10px;">
        <h4>üéÆ Mise en situation</h4>
        <p>Vous devez g√©n√©rer un message clair pour un e-mail transactionnel.</p>
        <button class="example-toggle">Voir la solution</button>
        <div class="example-content">
<pre><span class="var">$prenom</span> = <span class="str">"Lina"</span>;
<span class="var">$montant</span> = <span class="num">49.9</span>;
<span class="var">$message</span> = <span class="fn">sprintf</span>(<span class="str">"Bonjour %s, votre paiement de %.2f‚Ç¨ est valid√©."</span>, <span class="var">$prenom</span>, <span class="var">$montant</span>);
<span class="kw">echo</span> <span class="var">$message</span>;</pre>
        </div>
    </div>
</section>

<section>
    <h3>2. Formatage & Alignement</h3>
    <p>Les strings servent aussi √† pr√©senter des donn√©es : prix, colonnes, dates, identifiants.</p>

    <div class="grid2">
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Formatage.php</div>
            <pre><span class="var">$id</span> = <span class="num">42</span>;
<span class="var">$prix</span> = <span class="num">9.5</span>;

<span class="var">$label</span> = <span class="fn">sprintf</span>(<span class="str">"#%05d"</span>, <span class="var">$id</span>);
<span class="var">$montant</span> = <span class="fn">number_format</span>(<span class="var">$prix</span>, <span class="num">2</span>, <span class="str">","</span>, <span class="str">" "</span>);
<span class="kw">echo</span> <span class="var">$label</span> . <span class="str">" - "</span> . <span class="var">$montant</span>;</pre>
        </div>
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Alignement.php</div>
            <pre><span class="var">$title</span> = <span class="str">"PHP"</span>;
<span class="var">$line</span> = <span class="fn">str_pad</span>(<span class="var">$title</span>, <span class="num">10</span>, <span class="str">"."</span>, <span class="var">STR_PAD_BOTH</span>);
<span class="kw">echo</span> <span class="var">$line</span>;</pre>
        </div>
    </div>
</section>

<section>
    <h3>3. Fonctions Modernes (PHP 8+)</h3>
    <p>Fini les <code>strpos()</code> illisibles. PHP 8 a introduit des fonctions s√©mantiques claires.</p>

    <div class="code">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>ModernStrings.php</div>
        <pre><span class="var">$url</span> = <span class="str">"https://hylst.fr/blog/article"</span>;

<span class="fn">str_contains</span>(<span class="var">$url</span>, <span class="str">'blog'</span>);       <span class="c">// true</span>
<span class="fn">str_starts_with</span>(<span class="var">$url</span>, <span class="str">'https'</span>);  <span class="c">// true</span>
<span class="fn">str_ends_with</span>(<span class="var">$url</span>, <span class="str">'article'</span>);    <span class="c">// true</span>

<span class="c">// Manipulation de casse</span>
<span class="fn">strtolower</span>(<span class="str">"PHP"</span>); <span class="c">// php</span>
<span class="fn">strtoupper</span>(<span class="str">"php"</span>); <span class="c">// PHP</span>
<span class="fn">ucfirst</span>(<span class="str">"hello"</span>);  <span class="c">// Hello (Upper Case First)</span></pre>
    </div>

    <div class="ref-card" style="margin-top:10px;">
        <h4>üîÅ Alternatives √† conna√Ætre</h4>
        <ul>
            <li><code>str_contains</code> ‚Üî <code>strpos</code> (test explicite)</li>
            <li><code>str_starts_with</code> ‚Üî <code>substr</code></li>
            <li><code>mb_strtolower</code> ‚Üî <code>strtolower</code> en UTF-8</li>
        </ul>
    </div>
</section>

<section>
    <h3>4. Recherche, D√©coupe, Remplacement</h3>
    <div class="grid2">
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>D√©coupe.php</div>
            <pre><span class="var">$slug</span> = <span class="str">"guide-php-8"</span>;
<span class="var">$parts</span> = <span class="fn">explode</span>(<span class="str">"-"</span>, <span class="var">$slug</span>);
<span class="var">$first</span> = <span class="fn">substr</span>(<span class="var">$slug</span>, <span class="num">0</span>, <span class="num">5</span>);
<span class="kw">print_r</span>(<span class="var">$parts</span>);</pre>
        </div>
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Remplacement.php</div>
            <pre><span class="var">$txt</span> = <span class="str">"Bonjour    le   monde"</span>;
<span class="var">$clean</span> = <span class="fn">preg_replace</span>(<span class="str">"/\s+/"</span>, <span class="str">" "</span>, <span class="var">$txt</span>);
<span class="var">$safe</span> = <span class="fn">str_replace</span>(<span class="str">"monde"</span>, <span class="str">"PHP"</span>, <span class="var">$clean</span>);
<span class="kw">echo</span> <span class="var">$safe</span>;</pre>
        </div>
    </div>

    <div class="ref-card" style="margin-top:10px;">
        <h4>üß≠ Alternatives rapides</h4>
        <ul>
            <li><code>explode</code> ‚Üî <code>preg_split</code> ‚Üî <code>str_getcsv</code></li>
            <li><code>str_replace</code> ‚Üî <code>strtr</code> ‚Üî <code>preg_replace</code></li>
            <li><code>substr</code> ‚Üî <code>mb_substr</code> en UTF-8</li>
        </ul>
    </div>

    <div class="ref-card" style="margin-top:10px;">
        <h4>üéÆ Mini-simulation</h4>
        <p>Transformer un titre en slug propre et stable.</p>
        <button class="example-toggle">Voir la solution</button>
        <div class="example-content">
<pre><span class="var">$titre</span> = <span class="str">" PHP & S√©curit√© : les bases "</span>;
<span class="var">$slug</span> = <span class="fn">trim</span>(<span class="var">$titre</span>);
<span class="var">$slug</span> = <span class="fn">mb_strtolower</span>(<span class="var">$slug</span>);
<span class="var">$slug</span> = <span class="fn">preg_replace</span>(<span class="str">"/[^a-z0-9]+/u"</span>, <span class="str">"-"</span>, <span class="var">$slug</span>);
<span class="var">$slug</span> = <span class="fn">trim</span>(<span class="var">$slug</span>, <span class="str">"-"</span>);
<span class="kw">echo</span> <span class="var">$slug</span>;</pre>
        </div>
    </div>
</section>

<section>
    <h3>5. Nettoyage et S√©curit√© (XSS, Injection, Filtres)</h3>
    <div class="warning">
        <strong>üö® R√®gle d'or :</strong> Ne faites jamais confiance au texte venant de l'utilisateur
        (<code>$_POST</code>, <code>$_GET</code>).
    </div>

    <div class="grid2">
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>√âchappement HTML</div>
            <pre><span class="var">$input</span> = <span class="str">"&lt;script&gt;alert('Hacked')&lt;/script&gt;"</span>;
<span class="kw">echo</span> <span class="fn">htmlspecialchars</span>(<span class="var">$input</span>, <span class="var">ENT_QUOTES</span> | <span class="var">ENT_SUBSTITUTE</span>, <span class="str">"UTF-8"</span>);</pre>
        </div>
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Validation</div>
            <pre><span class="var">$email</span> = <span class="str">"  user@domain.com  "</span>;
<span class="var">$email</span> = <span class="fn">trim</span>(<span class="var">$email</span>);
<span class="var">$ok</span> = <span class="fn">filter_var</span>(<span class="var">$email</span>, <span class="var">FILTER_VALIDATE_EMAIL</span>);</pre>
        </div>
    </div>

    <div class="grid2" style="margin-top:10px;">
        <div class="ref-card">
            <h4>üß± Contextes d'√©chappement</h4>
            <ul>
                <li>HTML : <code>htmlspecialchars</code></li>
                <li>URL : <code>rawurlencode</code></li>
                <li>JS : <code>json_encode</code></li>
            </ul>
        </div>
        <div class="ref-card">
            <h4>üß¨ Injection SQL</h4>
            <p>√âvitez la concat√©nation. Utilisez des requ√™tes pr√©par√©es avec PDO.</p>
        </div>
    </div>

    <div class="code" style="margin-top:10px;">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>Nettoyage.php</div>
        <pre><span class="var">$raw</span> = <span class="str">"  &lt;b&gt;Alice&lt;/b&gt;  "</span>;
<span class="var">$clean</span> = <span class="fn">trim</span>(<span class="var">$raw</span>);
<span class="var">$clean</span> = <span class="fn">strip_tags</span>(<span class="var">$clean</span>);
<span class="var">$safe</span> = <span class="fn">htmlspecialchars</span>(<span class="var">$clean</span>, <span class="var">ENT_QUOTES</span> | <span class="var">ENT_SUBSTITUTE</span>, <span class="str">"UTF-8"</span>);
<span class="kw">echo</span> <span class="var">$safe</span>;</pre>
    </div>

    <div class="ref-card" style="margin-top:10px;">
        <h4>üéÆ Mise en situation s√©curit√©</h4>
        <p>Un champ "bio" accepte du texte, mais pas de scripts.</p>
        <button class="example-toggle">Voir la solution</button>
        <div class="example-content">
<pre><span class="var">$bio</span> = <span class="str">"&lt;img src=x onerror=alert(1)&gt;Salut"</span>;
<span class="var">$bio</span> = <span class="fn">strip_tags</span>(<span class="var">$bio</span>);
<span class="var">$bio</span> = <span class="fn">htmlspecialchars</span>(<span class="var">$bio</span>, <span class="var">ENT_QUOTES</span> | <span class="var">ENT_SUBSTITUTE</span>, <span class="str">"UTF-8"</span>);
<span class="kw">echo</span> <span class="var">$bio</span>;</pre>
        </div>
    </div>
</section>

<section>
    <h3>6. Le pi√®ge de l'Unicode (UTF-8)</h3>
    <p>PHP traite par d√©faut les cha√Ænes comme des tableaux d'octets. Un accent ou un emoji occupe plusieurs octets, ce
        qui casse les fonctions classiques.</p>

    <div class="code">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>Multibyte.php</div>
        <pre><span class="var">$txt</span> = <span class="str">"√âl√©phant üêò"</span>;

<span class="c">// ‚ùå Erreur : comptera 14 octets</span>
<span class="kw">echo</span> <span class="fn">strlen</span>(<span class="var">$txt</span>); 

<span class="c">// ‚úÖ Correct : comptera 10 caract√®res</span>
<span class="kw">echo</span> <span class="fn">mb_strlen</span>(<span class="var">$txt</span>); 

<span class="c">// Toujours utiliser mb_* pour :</span>
<span class="c">// mb_substr(), mb_strpos(), mb_strtolower()...</span></pre>
    </div>

    <div class="ref-card" style="margin-top:10px;">
        <h4>üß∞ Alternatives UTF-8</h4>
        <ul>
            <li><code>mb_strlen</code> ‚Üî <code>strlen</code></li>
            <li><code>mb_substr</code> ‚Üî <code>substr</code></li>
            <li><code>mb_strtoupper</code> ‚Üî <code>strtoupper</code></li>
        </ul>
    </div>
</section>

<section>
    <h3>7. De String √† Array (et inversement)</h3>
    <div class="code">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span class="dot g"></span>Explode
            & Implode</div>
        <pre><span class="var">$tags</span> = <span class="str">"php,js,html"</span>;

<span class="c">// String -> Array</span>
<span class="var">$list</span> = <span class="fn">explode</span>(<span class="str">","</span>, <span class="var">$tags</span>);

<span class="c">// Array -> String</span>
<span class="kw">echo</span> <span class="fn">implode</span>(<span class="str">" | "</span>, <span class="var">$list</span>); 
<span class="c">// Affiche : "php | js | html"</span></pre>
    </div>

    <div class="grid2" style="margin-top:10px;">
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>CSV.php</div>
            <pre><span class="var">$line</span> = <span class="str">"php,security,\"clean input\""</span>;
<span class="var">$cols</span> = <span class="fn">str_getcsv</span>(<span class="var">$line</span>);
<span class="kw">print_r</span>(<span class="var">$cols</span>);</pre>
        </div>
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>D√©coupageAvanc√©.php</div>
            <pre><span class="var">$text</span> = <span class="str">"un, deux ; trois | quatre"</span>;
<span class="var">$parts</span> = <span class="fn">preg_split</span>(<span class="str">"/\s*[;,|]\s*/"</span>, <span class="var">$text</span>);
<span class="kw">print_r</span>(<span class="var">$parts</span>);</pre>
        </div>
    </div>
</section>

<section>
    <h3>8. Comparaison & Validation</h3>
    <div class="grid2">
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>Comparaison.php</div>
            <pre><span class="var">$a</span> = <span class="str">"File9"</span>;
<span class="var">$b</span> = <span class="str">"File10"</span>;
<span class="var">$nat</span> = <span class="fn">strnatcmp</span>(<span class="var">$a</span>, <span class="var">$b</span>);
<span class="kw">echo</span> <span class="var">$nat</span>;</pre>
        </div>
        <div class="code">
            <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                    class="dot g"></span>TimingSafe.php</div>
            <pre><span class="var">$tokenA</span> = <span class="str">"abc"</span>;
<span class="var">$tokenB</span> = <span class="str">"abc"</span>;
<span class="var">$ok</span> = <span class="fn">hash_equals</span>(<span class="var">$tokenA</span>, <span class="var">$tokenB</span>);
<span class="kw">echo</span> <span class="var">$ok</span>;</pre>
        </div>
    </div>

    <div class="ref-card" style="margin-top:10px;">
        <h4>üß≠ Alternatives utiles</h4>
        <ul>
            <li><code>strcmp</code> ‚Üî <code>strcasecmp</code> pour ignorer la casse</li>
            <li><code>strnatcmp</code> pour un tri humain</li>
            <li><code>hash_equals</code> pour comparer des secrets</li>
        </ul>
    </div>
</section>

<div class="tip">
    <strong>üí° Regex (Expression R√©guli√®re)</strong><br>
    Pour des recherches complexes (ex: v√©rifier un format de t√©l√©phone), utilisez <code>preg_match()</code>.<br>
    <code>preg_match('/^[0-9]{10}$/', $num);</code>
</div>
