<div class="sec-header">
    <div class="sec-num">07</div>
    <div>
        <h2 class="sec-title">Gestion des Erreurs & Exceptions</h2>
        <p class="sec-sub">S√©curiser son code contre l'impr√©visible</p>
    </div>
</div>

<div class="intro-box">
    <p>Un bon d√©veloppeur ne code pas seulement pour le "chemin id√©al" (Happy Path). Il pr√©voit ce qui se passe quand
        tout casse : base de donn√©es hors ligne, fichier manquant ou erreur de saisie utilisateur.</p>
</div>

<!-- PARTIE 1 : ERREUR VS EXCEPTION -->
<section>
    <h3>1. Erreur vs Exception : La nuance</h3>
    <div class="grid2">
        <div class="ref-card">
            <h4>üö® L'Erreur (Interne)</h4>
            <p>Elle vient du coeur de PHP. C'est un signal syst√®me (ex: variable oubli√©e, faute de frappe).</p>
            <p><em>Analogie : La fum√©e qui sort du moteur.</em></p>
        </div>
        <div class="ref-card">
            <h4>‚ö†Ô∏è L'Exception (Logique)</h4>
            <p>C'est vous qui la d√©clenchez quand une r√®gle m√©tier est viol√©e (ex: solde bancaire insuffisant).</p>
            <p><em>Analogie : Le d√©tecteur de fum√©e qui sonne.</em></p>
        </div>
    </div>
</section>

<!-- PARTIE 2 : NIVEAUX D'ERREUR -->
<section>
    <h3>2. Les niveaux d'erreurs classiques</h3>
    <p>Toutes les erreurs ne sont pas fatales. PHP les classe par gravit√© :</p>
    <table>
        <tr>
            <th>Niveau</th>
            <th>Impact</th>
            <th>Exemple</th>
        </tr>
        <tr>
            <td><code>E_NOTICE</code></td>
            <td>L√©ger</td>
            <td>Utiliser une variable non d√©finie.</td>
        </tr>
        <tr>
            <td><code>E_WARNING</code></td>
            <td>Moyen</td>
            <td>Inclure un fichier inexistant (<code>include</code>).</td>
        </tr>
        <tr>
            <td><code>E_ERROR</code></td>
            <td>Fatal üíÄ</td>
            <td>Appeler une fonction qui n'existe pas. Arr√™t du script.</td>
        </tr>
        <tr>
            <td><code>E_DEPRECATED</code></td>
            <td>Info</td>
            <td>Utiliser une fonction qui va dispara√Ætre bient√¥t.</td>
        </tr>
    </table>
</section>

<!-- PARTIE 3 : EXCEPTIONS & TRY/CATCH -->
<section>
    <h3>3. Ma√Ætriser le Try / Catch</h3>
    <p>C'est le filet de s√©curit√©. Si une exception est lanc√©e dans le <code>try</code>, PHP saute directement au
        <code>catch</code> sans arr√™ter le site.</p>

    <div class="code">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>TryCatchFinally.php</div>
        <pre><span class="kw">try</span> {
    <span class="c">// 1. Tentative d'action risqu√©e</span>
    <span class="kw">if</span> (!<span class="fn">file_exists</span>(<span class="str">'config.json'</span>)) {
        <span class="kw">throw new</span> <span class="fn">Exception</span>(<span class="str">"Fichier de config introuvable !"</span>);
    }
} <span class="kw">catch</span> (<span class="fn">Exception</span> <span class="var">$e</span>) {
    <span class="c">// 2. R√©cup√©ration du crash</span>
    <span class="kw">echo</span> <span class="str">"D√©sol√©, il y a eu un souci : "</span> . <span class="var">$e</span>-><span class="fn">getMessage</span>();
} <span class="kw">finally</span> {
    <span class="c">// 3. Toujours ex√©cut√© (ex: fermer la BDD)</span>
    <span class="kw">echo</span> <span class="str">"Nettoyage..."</span>;
}</pre>
    </div>
</section>

<!-- PARTIE 4 : PHP 8 MODERNE -->
<section>
    <h3>4. Throw Expression (PHP 8.0+)</h3>
    <p>Avant PHP 8, <code>throw</code> √©tait une instruction. Maintenant, c'est une <strong>expression</strong>. On peut
        l'utiliser partout, m√™me dans des ternaires.</p>

    <div class="code">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>ModernThrow.php</div>
        <pre><span class="c">// Une ligne au lieu d'un bloc IF complet</span>
<span class="var">$id</span> = <span class="var">$_GET</span>[<span class="str">'id'</span>] ?? <span class="kw">throw new</span> <span class="fn">InvalidArgumentException</span>(<span class="str">"ID manquant !"</span>);

<span class="c">// Utilisation dans une Arrow Function</span>
<span class="var">$fn</span> = <span class="kw">fn</span>() => <span class="kw">throw new</span> <span class="fn">Exception</span>();</pre>
    </div>
</section>

<!-- PARTIE 5 : EXCEPTIONS PERSONNALISEES -->
<section>
    <h3>5. Cr√©er ses propres Exceptions</h3>
    <p>Pour mieux organiser vos erreurs, h√©ritez de la classe de base.</p>

    <div class="code">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>CustomException.php</div>
        <pre><span class="kw">class</span> <span class="fn">DatabaseException</span> <span class="kw">extends</span> <span class="fn">Exception</span> {}

<span class="kw">try</span> {
    <span class="c">// ... code BDD</span>
} <span class="kw">catch</span> (<span class="fn">DatabaseException</span> <span class="var">$e</span>) {
    <span class="c">// G√®re seulement les erreurs BDD ici</span>
} <span class="kw">catch</span> (<span class="fn">Exception</span> <span class="var">$e</span>) {
    <span class="c">// G√®re le reste</span>
}</pre>
    </div>
</section>

<div class="warning">
    <strong>üõ°Ô∏è S√©curit√© en Production</strong><br>
    N'affichez JAMAIS les erreurs sur votre site public (<code>display_errors = Off</code>). <br>
    Un pirate pourrait utiliser les chemins de fichiers ou les noms de tables affich√©s pour vous attaquer.
</div>

<div class="tip">
    <strong>üí° Astuce D√©bug</strong><br>
    Utilisez <code>error_reporting(E_ALL);</code> au d√©but de vos scripts en d√©veloppement pour √™tre au courant du
    moindre petit oubli.
</div>