<div class="sec-header">
    <div class="sec-num">09</div>
    <div>
        <h2 class="sec-title">Sessions & Cookies</h2>
        <p class="sec-sub">G√©rer l'√©tat et la persistance sur un web sans m√©moire</p>
    </div>
</div>

<div class="intro-box">
    <p>Le protocole HTTP est "stateless" (sans √©tat) : le serveur oublie qui vous √™tes d√®s que la page est charg√©e. Les
        Sessions et Cookies sont les outils qui permettent au web de se "souvenir" de vous (connexion, panier,
        pr√©f√©rences).</p>
</div>

<!-- PARTIE 1 : ANALOGIES -->
<section>
    <h3>1. Analogie : Le Club de Sport</h3>
    <div class="grid2">
        <div class="ref-card">
            <h4>üç™ Le Cookie : La Carte de Visite</h4>
            <p>Le serveur vous donne une petite carte que <strong>vous</strong> gardez dans votre poche (votre
                navigateur). √Ä chaque visite, vous la lui montrez.</p>
            <p><em>Risque : On peut vous la voler ou vous pouvez la modifier.</em></p>
        </div>
        <div class="ref-card">
            <h4>üîí La Session : Le Casier</h4>
            <p>Le serveur garde vos affaires dans un casier <strong>chez lui</strong>. Il vous donne juste la cl√© (le
                Session ID). Vous ne pouvez pas modifier le contenu du casier vous-m√™me.</p>
            <p><em>S√©curit√© : C'est beaucoup plus s√ªr pour les donn√©es sensibles.</em></p>
        </div>
    </div>
</section>

<!-- PARTIE 2 : SESSIONS -->
<section>
    <h3>2. Ma√Ætriser les Sessions</h3>
    <p>Une session d√©pose automatiquement un cookie nomm√© <code>PHPSESSID</code> sur votre navigateur.</p>

    <div class="code">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>Sessions.php</div>
        <pre><span class="c">// 1. TOUJOURS d√©marrer en haut du fichier</span>
<span class="fn">session_start</span>();

<span class="c">// 2. Stocker des donn√©es</span>
<span class="var">$_SESSION</span>[<span class="str">'user'</span>] = [
    <span class="str">'id'</span> => <span class="num">42</span>,
    <span class="str">'role'</span> => <span class="str">'admin'</span>
];

<span class="c">// 3. Utiliser les donn√©es</span>
<span class="kw">if</span> (<span class="fn">isset</span>(<span class="var">$_SESSION</span>[<span class="str">'user'</span>])) {
    <span class="kw">echo</span> <span class="str">"Bienvenue "</span> . <span class="var">$_SESSION</span>[<span class="str">'user'</span>][<span class="str">'id'</span>];
}

<span class="c">// 4. S√©curit√© : R√©g√©n√©rer l'ID au login (Contre le Session Fixation)</span>
<span class="fn">session_regenerate_id</span>(<span class="kw">true</span>);

<span class="c">// 5. D√©truire (D√©connexion)</span>
<span class="fn">session_destroy</span>();</pre>
    </div>
</section>

<!-- PARTIE 3 : COOKIES -->
<section>
    <h3>3. Utiliser les Cookies intelligemment</h3>
    <p>Les cookies ont une date d'expiration. Si on ne la met pas, ils meurent √† la fermeture du navigateur.</p>

    <div class="code">
        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                class="dot g"></span>Cookies.php</div>
        <pre><span class="c">// Cr√©er un cookie "Th√®me Sombre" pour 30 jours</span>
<span class="var">$expiration</span> = <span class="fn">time</span>() + (<span class="num">3600</span> * <span class="num">24</span> * <span class="num">30</span>);

<span class="fn">setcookie</span>(
    name: <span class="str">"theme"</span>,
    value: <span class="str">"dark"</span>,
    expires_or_options: [
        <span class="str">'expires'</span> => <span class="var">$expiration</span>,
        <span class="str">'path'</span> => <span class="str">'/'</span>,
        <span class="str">'httponly'</span> => <span class="kw">true</span>, <span class="c">// üõ°Ô∏è Invisible pour le JavaScript (Contre XSS)</span>
        <span class="str">'samesite'</span> => <span class="str">'Lax'</span>  <span class="c">// üõ°Ô∏è Contre les attaques CSRF</span>
    ]
);

<span class="c">// Lire un cookie</span>
<span class="var">$theme</span> = <span class="var">$_COOKIE</span>[<span class="str">'theme'</span>] ?? <span class="str">'light'</span>;</pre>
    </div>
</section>

<div class="warning">
    <strong>üõ°Ô∏è RGPD & Cookies</strong><br>
    En Europe, vous devez informer l'utilisateur si vous utilisez des cookies qui ne sont pas "strictement n√©cessaires"
    au fonctionnement du site.
</div>

<div class="tip">
    <strong>üí° Flash Messages</strong><br>
    On utilise souvent les sessions pour afficher un message de succ√®s (ex: "Profil mis √† jour") qui s'efface d√®s qu'on
    rafra√Æchit la page.
</div>