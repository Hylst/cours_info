<section id="s2">
    <div class="container">
        <div class="sec-header">
            <div class="sec-num">02</div>
            <div>
                <h2 class="sec-title">Flask : Fondations & Patterns Pro</h2>
                <p class="sec-sub">Micro-framework WSGI flexible et extensible</p>
            </div>
        </div>

        <div class="intro-box"
            style="margin-bottom: 30px; background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border);">
            <p>Flask est dit <strong>"Micro"</strong> non pas parce qu'il manque de puissance, mais parce qu'il ne prend
                pas de dÃ©cisions Ã  votre place (pas d'ORM imposÃ©, pas de systÃ¨me de login par dÃ©faut). Il repose sur
                deux piliers : <strong>Werkzeug</strong> (WSGI) et <strong>Jinja2</strong> (Templating).</p>
        </div>

        <div class="grid2">
            <div>
                <h3>1. Architecture & Cycle de Vie</h3>
                <p>Dans une application Flask, le flux suit une route prÃ©cise de la requÃªte Ã  la rÃ©ponse :</p>
                <div class="mermaid" style="background: var(--bg2); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    graph LR
                    A["Navigateur"] -->|RequÃªte HTTP| B["Werkzeug / WSGI"]
                    B --> C["Flask App"]
                    C --> D{"Route / URL"}
                    D -->|Blueprint A| E["Logic"]
                    D -->|Blueprint B| F["Logic"]
                    E -->|Jinja2| G["HTML / JSON"]
                    F -->|Jinja2| G
                    G -->|RÃ©ponse HTTP| B
                    B --> A
                </div>
            </div>
            <div>
                <h3>2. Les Contextes (La "Magie" de Flask)</h3>
                <p>Flask utilise des <strong>Proxies</strong> pour accÃ©der Ã  des donnÃ©es globales sans polluer les
                    signatures de fonctions :</p>
                <ul class="ref-list" style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 10px;"><strong><code>request</code></strong> : AccÃ¨s aux donnÃ©es de la
                        requÃªte (args, form, json).</li>
                    <li style="margin-bottom: 10px;"><strong><code>session</code></strong> : Stockage sÃ©curisÃ© cÃ´tÃ©
                        client (cookies signÃ©s).</li>
                    <li style="margin-bottom: 10px;"><strong><code>g</code></strong> : Objet temporaire pour une seule
                        requÃªte (ex: stocker la connexion DB).</li>
                    <li style="margin-bottom: 10px;"><strong><code>current_app</code></strong> : AccÃ¨s Ã  l'instance de
                        l'application active.</li>
                </ul>
            </div>
        </div>

        <h3 style="margin-top:40px">3. Structure "Industrielle" (Factory & Blueprints)</h3>
        <p>Pour un projet sÃ©rieux, on Ã©vite le fichier unique. On utilise le <strong>Application Factory
                Pattern</strong>.</p>

        <div class="grid2">
            <div class="code">
                <div class="code-head"><span class="dot r"></span>Arborescence Type</div>
                <pre>/mon_projet
â”œâ”€â”€ /app                <span class="c"># Package principal</span>
â”‚   â”œâ”€â”€ __init__.py     <span class="c"># Initialisation (Factory)</span>
â”‚   â”œâ”€â”€ models.py       <span class="c"># DÃ©finition des DB</span>
â”‚   â”œâ”€â”€ /auth           <span class="c"># Module d'authentification</span>
â”‚   â”‚   â”œâ”€â”€ routes.py
â”‚   â”‚   â””â”€â”€ forms.py
â”‚   â””â”€â”€ /api            <span class="c"># Module API REST</span>
â”‚       â””â”€â”€ routes.py
â”œâ”€â”€ config.py           <span class="c"># Configurations (Dev, Prod, Test)</span>
â””â”€â”€ requirements.txt</pre>
            </div>

            <div class="code">
                <div class="code-head"><span class="dot g"></span>Exemple __init__.py</div>
                <pre><span class="kw">from</span> flask <span class="kw">import</span> Flask
<span class="kw">from</span> flask_sqlalchemy <span class="kw">import</span> SQLAlchemy

<span class="var">db</span> = <span class="cls">SQLAlchemy</span>()

<span class="kw">def</span> <span class="fn">create_app</span>():
    <span class="var">app</span> = <span class="cls">Flask</span>(<span class="var">__name__</span>)
    <span class="var">app</span>.<span class="prop">config</span>.<span class="fn">from_object</span>(<span class="str">'config.Config'</span>)

    <span class="var">db</span>.<span class="fn">init_app</span>(<span class="var">app</span>)

    <span class="c"># Enregistrement des Blueprints</span>
    <span class="kw">from</span> .auth <span class="kw">import</span> auth_bp
    <span class="var">app</span>.<span class="fn">register_blueprint</span>(<span class="var">auth_bp</span>, <span class="var">url_prefix</span>=<span class="str">'/auth'</span>)

    <span class="kw">return</span> <span class="var">app</span></pre>
            </div>
        </div>

        <div class="warning"
            style="margin-top: 30px; background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--orange); padding: 15px; border-radius: 4px;">
            <strong>ðŸ’¡ Pourquoi les Blueprints ?</strong> Ils permettent de dÃ©coupler votre code. Vous pouvez tester le
            module "Auth" indÃ©pendamment du module "API", et mÃªme les rÃ©utiliser dans d'autres projets Flask.
        </div>

        <h3 style="margin-top:40px">4. Jinja2 : Plus qu'un simple moteur</h3>
        <div class="grid3">
            <div class="ref-card">
                <h4>HÃ©ritage</h4>
                <p>DÃ©finissez un <code>base.html</code> et "Ã©tendez-le" dans vos pages avec
                    <code>{% extends "base.html" %}</code>.
                </p>
            </div>
            <div class="ref-card">
                <h4>Filtres</h4>
                <p>Transformez vos donnÃ©es dans l'HTML : <code>{{ date | format_date }}</code> ou
                    <code>{{ texte | truncate(50) }}</code>.
                </p>
            </div>
            <div class="ref-card">
                <h4>Macros</h4>
                <p>CrÃ©ez des composants rÃ©utilisables (fonctions HTML) pour vos formulaires ou boutons.</p>
            </div>
        </div>

        <details style="margin-top: 30px;">
            <summary>âž• Extensions Essentielles</summary>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Extension</th>
                            <th>RÃ´le</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Flask-SQLAlchemy</code></td>
                            <td>IntÃ©gration simplifiÃ©e de l'ORM SQLAlchemy.</td>
                        </tr>
                        <tr>
                            <td><code>Flask-Migrate</code></td>
                            <td>Gestion des migrations de base de donnÃ©es (Alembic).</td>
                        </tr>
                        <tr>
                            <td><code>Flask-Login</code></td>
                            <td>Gestion des sessions et authentification utilisateur.</td>
                        </tr>
                        <tr>
                            <td><code>Flask-WTF</code></td>
                            <td>Formulaires sÃ©curisÃ©s avec protection CSRF.</td>
                        </tr>
                        <tr>
                            <td><code>Flask-JWT-Extended</code></td>
                            <td>Authentification par jeton (JSON Web Tokens).</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </details>
    </div>
</section>