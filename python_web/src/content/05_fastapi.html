<section id="s5">
    <div class="container">
        <div class="sec-header">
            <div class="sec-num">05</div>
            <div>
                <h2 class="sec-title">FastAPI : La Performance Moderne</h2>
                <p class="sec-sub">Framework ASGI ultra-rapide bas√© sur les types Python 3.10+</p>
            </div>
        </div>

        <div class="intro-box"
            style="margin-bottom: 30px; background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border);">
            <p>FastAPI est le framework qui a r√©volutionn√© le backend Python r√©cent. Il repose sur deux piliers :
                <strong>Starlette</strong> (pour la partie web asynchrone) et <strong>Pydantic</strong> (pour la
                validation de donn√©es ultra-rapide). Sa signature ? L'utilisation massive des <code>Type Hints</code> de
                Python pour g√©n√©rer automatiquement de la documentation et valider les requ√™tes.</p>
        </div>

        <div class="grid2">
            <div>
                <h3>1. ASGI vs WSGI : L'Asynchronisme</h3>
                <p>Contrairement √† Flask (WSGI), FastAPI est <strong>ASGI</strong> (Asynchronous Server Gateway
                    Interface). Il peut g√©rer des milliers de connexions simultan√©ment sans bloquer le serveur.</p>
                <div class="mermaid" style="background: var(--bg2); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    graph TD
                    subgraph "WSGI (Synchrone)"
                    W1[Req 1] --> S1[Occup√©]
                    W2[Req 2] --> S1
                    end
                    subgraph "ASGI (Asynchrone)"
                    A1[Req 1] --> EventLoop
                    A2[Req 2] --> EventLoop
                    EventLoop --> S2[G√®re tout en parall√®le]
                    end
                </div>
            </div>
            <div>
                <h3>2. Validation & Pydantic</h3>
                <p>Fini les erreurs de type <code>KeyError</code>. FastAPI convertit le JSON entrant en vrais objets
                    Python typ√©s.</p>
                <div class="code">
                    <div class="code-head"><span class="dot g"></span>schemas.py</div>
                    <pre><span class="kw">from</span> pydantic <span class="kw">import</span> BaseModel, Field

<span class="kw">class</span> <span class="cls">Item</span>(<span class="cls">BaseModel</span>):
    <span class="var">name</span>: <span class="cls">str</span>
    <span class="var">price</span>: <span class="cls">float</span> = <span class="fn">Field</span>(gt=<span class="num">0</span>, description=<span class="str">"Doit √™tre positif"</span>)
    <span class="var">is_offer</span>: <span class="cls">bool</span> | <span class="kw">None</span> = <span class="kw">None</span>

<span class="dec">@app.post</span>(<span class="str">"/items/"</span>)
<span class="kw">async def</span> <span class="fn">create_item</span>(<span class="var">item</span>: <span class="cls">Item</span>):
    <span class="kw">return</span> <span class="var">item</span>  <span class="c"># Auto-s√©rialisation JSON</span></pre>
                </div>
            </div>
        </div>

        <h3 style="margin-top:40px">3. Injection de D√©pendances (Depends)</h3>
        <p>FastAPI poss√®de un syst√®me puissant pour g√©rer les pr√©-requis (Auth, DB, Logging) de mani√®re modulaire.</p>
        <div class="code">
            <div class="code-head"><span class="dot r"></span>main.py</div>
            <pre><span class="kw">from</span> fastapi <span class="kw">import</span> Depends, Header

<span class="kw">async def</span> <span class="fn">get_token</span>(<span class="var">x_token</span>: <span class="cls">str</span> = <span class="fn">Header</span>()):
    <span class="kw">if</span> <span class="var">x_token</span> != <span class="str">"fake-secret"</span>:
        <span class="kw">raise</span> <span class="cls">HTTPException</span>(status_code=<span class="num">400</span>)
    <span class="kw">return</span> <span class="var">x_token</span>

<span class="dec">@app.get</span>(<span class="str">"/secure-data/"</span>)
<span class="kw">async def</span> <span class="fn">read_data</span>(<span class="var">token</span>: <span class="cls">str</span> = <span class="fn">Depends</span>(<span class="fn">get_token</span>)):
    <span class="kw">return</span> {<span class="str">"auth"</span>: <span class="kw">True</span>}</pre>
        </div>

        <h3 style="margin-top:40px">4. Auto-Documentation Magique</h3>
        <p>Sans aucun code suppl√©mentaire, FastAPI g√©n√®re deux documentations interactives compl√®tes :</p>
        <div class="grid2">
            <div class="ref-card">
                <h4>Swagger UI (/docs)</h4>
                <p>Permet de tester vos APIs directement depuis le navigateur avec un bouton "Try it out".</p>
            </div>
            <div class="ref-card">
                <h4>ReDoc (/redoc)</h4>
                <p>Une version plus structur√©e et design, id√©ale pour la documentation technique partag√©e avec d'autres
                    √©quipes.</p>
            </div>
        </div>

        <div class="info"
            style="margin-top: 30px; border-left: 4px solid var(--primary); background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 4px;">
            <strong>üí° Pourquoi l'utiliser ?</strong> Si vous construisez une API √† haute performance (Machine Learning,
            IoT, Real-time), FastAPI est le choix num√©ro 1. Pour les sites avec beaucoup de templates HTML c√¥t√© serveur,
            Flask ou Django restent pr√©f√©rables.
        </div>

        <details style="margin-top: 30px;">
            <summary>‚ûï Concepts Avanc√©s</summary>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Fonctionnalit√©</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Background Tasks</code></td>
                            <td>Lancer des fonctions apr√®s avoir renvoy√© une r√©ponse (ex: envoi d'email).</td>
                        </tr>
                        <tr>
                            <td><code>FastAPI Lifespan</code></td>
                            <td>G√©rer les √©v√©nements de d√©marrage et d'extinction (connexions DB).</td>
                        </tr>
                        <tr>
                            <td><code>Middleware</code></td>
                            <td>G√©rer les CORS, Gzip, ou ajouter des headers personnalis√©s.</td>
                        </tr>
                        <tr>
                            <td><code>Path & Query Params</code></td>
                            <td>Validation stricte des param√®tres d'URL via <code>Query</code> et <code>Path</code>.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </details>
    </div>
</section>