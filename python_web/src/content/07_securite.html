<section id="s7">
    <div class="container">
        <div class="sec-header">
            <div class="sec-num">07</div>
            <div>
                <h2 class="sec-title">S√©curit√© & Auth : Prot√©ger son Backend</h2>
                <p class="sec-sub">Hashing, JWT, CORS et Architecture D√©fensive</p>
            </div>
        </div>

        <div class="intro-box"
            style="margin-bottom: 30px; background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border);">
            <p>La s√©curit√© n'est pas une "feature" qu'on ajoute √† la fin, c'est une <strong>fondation</strong>. En
                Python Web, cela signifie g√©rer correctement l'identit√© (Authentification) et les droits (Autorisation),
                tout en se prot√©geant contre les menaces automatis√©es.</p>
        </div>

        <div class="grid2">
            <div>
                <h3>1. Hashing : La R√®gle du "Slow"</h3>
                <p>On ne stocke <strong>JAMAIS</strong> de mot de passe. On stocke un <code>Hash</code> unique. Plus
                    l'algorithme est "lent" (co√ªteux en CPU/M√©moire), plus il r√©siste aux attaques par force brute.</p>
                <div class="code">
                    <div class="code-head"><span class="dot g"></span>Argon2 (Recommand√©)</div>
                    <pre><span class="kw">from</span> passlib.context <span class="kw">import</span> CryptContext

<span class="var">pwd_context</span> = <span class="cls">CryptContext</span>(schemes=[<span class="str">"argon2"</span>, <span class="str">"bcrypt"</span>])

<span class="c"># Inscription</span>
<span class="var">hash</span> = <span class="var">pwd_context</span>.<span class="fn">hash</span>(<span class="str">"mypassword"</span>)

<span class="c"># V√©rification</span>
<span class="var">is_ok</span> = <span class="var">pwd_context</span>.<span class="fn">verify</span>(<span class="str">"mypassword"</span>, <span class="var">hash</span>)</pre>
                </div>
            </div>
            <div>
                <h3>2. JWT : Authentification Sans √âtat</h3>
                <p>Le <strong>JSON Web Token</strong> permet d'identifier un utilisateur sans interroger la DB √† chaque
                    requ√™te. Le secret c√¥t√© serveur garantit l'int√©grit√©.</p>
                <div class="mermaid" style="background: var(--bg2); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    sequenceDiagram
                    Client->>Server: Login (User/Pass)
                    Server-->>Client: JWT (Sign√© avec SECRET)
                    Note right of Client: Stock√© en m√©moire ou Cookie
                    Client->>Server: Requ√™te (Headers: Bearer JWT)
                    Server->>Server: V√©rifie Signature
                    Server-->>Client: Donn√©es
                </div>
            </div>
        </div>

        <h3 style="margin-top:40px">3. L'Arsenal de D√©fense (OWASP Tips)</h3>
        <div class="grid3">
            <div class="ref-card" style="border-top: 3px solid var(--red);">
                <h4>CORS</h4>
                <p>Configurez les <code>Cross-Origin Resource Sharing</code> pour n'autoriser que vos domaines front-end
                    de confiance.</p>
            </div>
            <div class="ref-card" style="border-top: 3px solid var(--orange);">
                <h4>Injection</h4>
                <p>Utilisez toujours les ORM (SQLAlchemy, Django) pour √©chapper automatiquement les param√®tres et √©viter
                    les injections SQL.</p>
            </div>
            <div class="ref-card" style="border-top: 3px solid var(--yellow);">
                <h4>Rate Limiting</h4>
                <p>Limitez le nombre de requ√™tes par IP (ex: via Flask-Limiter) pour contrer le DoS ou le brute-force.
                </p>
            </div>
        </div>

        <h3 style="margin-top:40px">4. Mise en Pratique : V√©rification de Token</h3>
        <div class="code">
            <div class="code-head"><span class="dot r"></span>Logic de D√©codage</div>
            <pre><span class="kw">from</span> jose <span class="kw">import</span> jwt, JWTError

<span class="kw">def</span> <span class="fn">validate_access</span>(<span class="var">token</span>: <span class="cls">str</span>):
    <span class="kw">try</span>:
        <span class="var">payload</span> = <span class="var">jwt</span>.<span class="fn">decode</span>(<span class="var">token</span>, <span class="var">SECRET_KEY</span>, algorithms=[<span class="str">"HS256"</span>])
        <span class="var">user_id</span> = <span class="var">payload</span>.<span class="fn">get</span>(<span class="str">"sub"</span>)
        <span class="kw">if</span> <span class="var">user_id</span> <span class="kw">is None</span>:
            <span class="kw">raise</span> <span class="cls">HTTPException</span>(status_code=<span class="num">401</span>)
        <span class="kw">return</span> <span class="var">user_id</span>
    <span class="kw">except</span> <span class="cls">JWTError</span>:
        <span class="kw">raise</span> <span class="cls">HTTPException</span>(status_code=<span class="num">401</span>, detail=<span class="str">"Invalid Token"</span>)</pre>
        </div>

        <div class="warning"
            style="margin-top: 30px; border-left: 4px solid var(--orange); background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 4px;">
            <strong>üõë Erreur Critique</strong> : Ne jamais placer de donn√©es sensibles (mots de passe, num√©ros CB) dans
            le <code>payload</code> d'un JWT. Le JWT est lisible par n'importe qui (Base64), il n'est que
            <strong>sign√©</strong>, pas chiffr√©.
        </div>

        <details style="margin-top: 30px;">
            <summary>‚ûï Approfondissement : RBAC vs ABAC</summary>
            <div class="grid2" style="margin-top: 15px;">
                <div class="ref-card">
                    <h4>RBAC (Role-Based)</h4>
                    <p>Permission bas√©e sur le titre (ex: admin, √©diteur, utilisateur). Simple et efficace pour la
                        plupart des apps.</p>
                </div>
                <div class="ref-card">
                    <h4>ABAC (Attribute-Based)</h4>
                    <p>Permission complexe bas√©e sur des attributs (ex: "Peut √©diter si l'article lui appartient ET s'il
                        est avant 18h").</p>
                </div>
            </div>
        </details>
    </div>
</section>