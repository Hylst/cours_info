<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>State - M√©mo React.js</title>
    <meta name="description" content="Le State dans React : useState hook, m√©moire des composants et r√©activit√©.">
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/quiz-style.css">
    <link rel="stylesheet" href="../style.css">
    <script src="../js/nav.js" defer></script>
    <script src="../script.js" defer></script>
</head>

<body>
    <header></header>
    <div class="main-layout">
        <aside id="sidebar-container"></aside>
        <main>
            <section id="s4" class="module-content">
                <div class="container">
                    <div class="sec-header">
                        <div class="sec-num">04</div>
                        <div>
                            <h2 class="sec-title">State (√âtat)</h2>
                            <p class="sec-sub">useState Hook</p>
                        </div>
                    </div>

                    <details>
                        <summary>üí° Pourquoi le State ?</summary>
                        <div class="details-content">
                            <p>En JS standard, changer une variable (<code>let x = 1</code>) ne met pas √† jour l'√©cran
                                automatiquement. React a besoin de savoir quand les donn√©es changent pour relancer le
                                rendu.</p>
                            <p>Le <strong>State</strong> est la "m√©moire" du composant. Quand vous appelez la fonction
                                de mise √†
                                jour (<code>setCount</code>), React planifie un nouveau rendu du composant avec la
                                nouvelle
                                valeur. C'est ce qui rend l'interface <strong>r√©active</strong>.</p>
                        </div>
                    </details>

                    <div class="code">
                        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                                class="dot g"></span>useState</div>
                        <pre><span class="kw">import</span> { <span class="fn">useState</span> } <span class="kw">from</span> <span class="str">'react'</span>;

<span class="kw">function</span> <span class="fn">Counter</span>() {
    <span class="c">// [√©tatActuel, fonctionDeMiseAJour] = useState(valeurInitiale)</span>
    <span class="kw">const</span> [<span class="var">count</span>, <span class="fn">setCount</span>] = <span class="fn">useState</span>(<span class="num">0</span>);

    <span class="kw">return</span> (
        <span class="tag">&lt;button</span> <span class="attr">onClick</span>={() => <span class="fn">setCount</span>(<span class="var">count</span> + <span class="num">1</span>)}<span class="tag">&gt;</span>
            Clics : {<span class="var">count</span>}
        <span class="tag">&lt;/button&gt;</span>
    );
}</pre>
                    </div>

                    <div class="code">
                        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                                class="dot g"></span>Mises √† jour asynchrones</div>
                        <pre><span class="c">// ‚ùå Risqu√© si plusieurs mises √† jour s'encha√Ænent</span>
<span class="fn">setCount</span>(<span class="var">count</span> + <span class="num">1</span>);
<span class="fn">setCount</span>(<span class="var">count</span> + <span class="num">1</span>); <span class="c">// √áa n'ajoutera que 1 au total !</span>

<span class="c">// ‚úÖ S√ªr : functional update (bas√© sur la valeur pr√©c√©dente)</span>
<span class="fn">setCount</span>(<span class="var">prev</span> => <span class="var">prev</span> + <span class="num">1</span>);
<span class="fn">setCount</span>(<span class="var">prev</span> => <span class="var">prev</span> + <span class="num">1</span>); <span class="c">// Ajoute bien 2</span></pre>
                    </div>

                    <div class="code">
                        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                                class="dot g"></span>Objets dans le State</div>
                        <pre><span class="kw">const</span> [<span class="var">user</span>, <span class="fn">setUser</span>] = <span class="fn">useState</span>({ <span class="prop">name</span>: <span class="str">"Bob"</span>, <span class="prop">age</span>: <span class="num">30</span> });

<span class="c">// ‚ö†Ô∏è Attention : React ne fusionne pas les objets automatiquement !</span>
<span class="fn">setUser</span>({ ...<span class="var">user</span>, <span class="prop">age</span>: <span class="num">31</span> }); <span class="c">// Il faut copier le reste avec "..."</span></pre>
                    </div>

                    <details>
                        <summary>üöÄ Concept : Lifting State Up</summary>
                        <div class="details-content">
                            <p>Si deux composants fr√®res (ex: Sidebar et Header) ont besoin de la m√™me donn√©e (ex:
                                <code>isMenuOpen</code>),
                                il faut "remonter" cet √©tat vers leur parent commun le plus proche, puis le redescendre
                                via les props.
                            </p>
                            <p>Le parent d√©tient le <code>useState</code> et passe la fonction
                                <code>setIsMenuOpen</code> aux enfants.
                            </p>
                        </div>
                    </details>


                    <div class="grid2" style="margin-top:20px;">
                        <div class="ref-card" style="background:var(--bg2); border-left:4px solid var(--primary);">
                            <h4>üì∏ Analogie : L'Instantan√© (Snapshot)</h4>
                            <p style="font-size:0.9rem; margin-top:10px;">
                                Le State n'est pas une variable normale qui change "en direct".
                                <br>
                                C'est une photo prise au moment du rendu. M√™me si vous changez le State, la variable
                                <code>count</code> dans la fonction <em>actuelle</em> ne change pas ! Elle changera au
                                <strong>prochain</strong> rendu (la prochaine photo).
                            </p>
                        </div>
                        <div class="ref-card" style="background:var(--bg2); border-left:4px solid var(--red);">
                            <h4>üö´ Anti-Pattern : Mutation Directe</h4>
                            <pre style="margin-top:5px; font-size:0.8rem; background:var(--bg);">
<span class="c">// NE MARCHE PAS</span>
<span class="var">user</span>.<span class="prop">name</span> = <span class="str">"Alice"</span>;
<span class="c">// React ne voit pas le changement !</span>

<span class="c">// IL FAUT REMPLACER L'OBJET</span>
<span class="fn">setUser</span>({ ...<span class="var">user</span>, <span class="prop">name</span>: <span class="str">"Alice"</span> });</pre>
                        </div>
                    </div>

                    <div class="code">
                        <div class="code-head"><span class="dot r"></span><span class="dot y"></span><span
                                class="dot g"></span>Concept : State Machine (Status)</div>
                        <pre><span class="c">// Au lieu de pleins de bool√©ens (isLoading, isError, isSuccess...)</span>
<span class="c">// Utilisez un seul string d'√©tat pour √©viter les √©tats impossibles.</span>
<span class="kw">const</span> [<span class="var">status</span>, <span class="fn">setStatus</span>] = <span class="fn">useState</span>(<span class="str">"idle"</span>); <span class="c">// "loading" | "success" | "error"</span>

<span class="kw">return</span> (
    <span class="tag">&lt;div&gt;</span>
        {<span class="var">status</span> === <span class="str">"idle"</span> && <span class="tag">&lt;StartBtn /&gt;</span>}
        {<span class="var">status</span> === <span class="str">"loading"</span> && <span class="tag">&lt;Spinner /&gt;</span>}
        {<span class="var">status</span> === <span class="str">"error"</span> && <span class="tag">&lt;ErrorMsg /&gt;</span>}
    <span class="tag">&lt;/div&gt;</span>
);</pre>
                    </div>

                    <div class="demo">
                        <div class="demo-title">D√©mo State (Simul√©)</div>
                        <div style="font-size:1.5rem; margin-bottom:10px; font-weight:bold; color:var(--primary)"
                            id="state-count">0</div>
                        <button class="demo-btn" onclick="demoState()">Incr√©menter (+1)</button>
                        <div id="demo-state-output" class="demo-output" style="margin-top:12px">Log cycle de vie</div>
                    </div>

                    <div class="nav-buttons">
                        <a href="03_props.html" class="btn-prev">‚Üê Props</a>
                        <a href="05_effect.html" class="btn-next">Suivant : Effect ‚Üí</a>
                    </div>
                </div>
            </section>
        </main>
    </div>
</body>

</html>